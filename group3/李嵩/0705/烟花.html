<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Document</title>
      <style>
            #container{
                  width: 600px;
                  height: 400px;
                  background: #000;
                  border: 2px solid #f10;
                  position: absolute;
                  left: 0;
                  top: 0;
                  bottom: 0;
                  right: 0;
                  margin: auto;
            }      
            
            .firework{
                  width: 7px;
                  height: 7px;
                  border-radius: 50%;
                  background: #fff;
                  position: absolute;
            }
      </style>
</head>
<body>
      <div id="container">
      </div>
      <script>
            // 1. 创造随机颜色的div的功能;
            // 2. 上升功能;
            // 3. 爆炸功能;

            class Firework{
                constructor(){
                    this.main=$("#container");
                    this.main = document.getElementById("container");
                  // 参数判断;
                  if(this.main === null){ return false};
                  this.init();
                }
            init(){
                  this.main.addEventListener("click" , this.hanlderFireClick.bind(this));//给主体添加事件监听，并改变hanlderFireClick的指向
            }
            hanlderFireClick (evt){//获取鼠标事件函数
                  var e = evt || window.event;
                  var offsetX = e.offsetX;//获取鼠标离主体左边的距离
                  var offsetY = e.offsetY;//获取鼠标离主体右边的距离
                  // // this => 实例对象;
                  // // 创建出一个随机颜色的div供我使用;
                  // var fire = this.createFirework();
                  // fire.style.left = offsetX + "px";
                  // fire.style.bottom = 0;
                  // this.main.appendChild(fire);
                  var fire = this.fireworkInit(offsetX);//将鼠标距离主体左边的距离传入烟花初始函数并调用
                  this.fireworkMove(fire,offsetY, this.fireworkBoom.bind(this,offsetX,offsetY));//调用烟花移动函数并将烟花，鼠标距离主体上边的距离传入，并传入指向改变的烟花爆炸函数
            }     
            fireworkBoom(offsetX,offsetY){//烟花爆炸函数
                  // console.log(offsetX,offsetY);
                  var randomFireCount = 15 + Math.round(Math.random() * 10);//烟花爆炸生成的数目随机15-25个；
                  var blank = Math.round(360 / randomFireCount);//爆炸生成的烟花之间的间隔
                  var r = 100 + Math.round(Math.random() * 100);//烟花爆炸的圆圈的半径随机100-200；
                  var angle = 0;

                  for(var i = 0 ; i < randomFireCount ; i++){
                        angle += blank;//生成每个烟花的间隔

                        var fire_targetX = Math.round(Math.cos( Math.PI / 180 * angle ) * r + offsetX);//爆炸烟花的X方向目标位置 
                        var fire_targetY = Math.round(Math.sin( Math.PI / 180 * angle ) * r + offsetY); //爆炸烟花的Y方向目标位置

                        var fire_boom = this.createFirework();//调用烟花创建函数
                        fire_boom.style.left = offsetX + "px";//烟花爆炸时的X方向位置
                        fire_boom.style.top  = offsetY + "px";//烟花爆炸时的Y方向位置
                        this.main.appendChild(fire_boom);//在主体上插入爆炸烟花

                        move(fire_boom , {
                              left : fire_targetX ,
                              top  : fire_targetY ,
                              opacity : 0.1
                        },function(fire_boom){
                              fire_boom.remove();
                        }.bind(false,fire_boom))//调用move函数（运动框架）并传参数 爆炸的烟花的运动
                  }

            }
           fireworkMove(fire , offsetY , boomCallback){//烟花移动函数
                  move(fire,{
                        top : offsetY
                  },function(){
                        fire.remove();
                        boomCallback();
                  });//给移动函数（运动框架传参） 初始烟花的运动
            }     
            fireworkInit(offsetX){//烟花初始函数
                  // this => 实例对象;
                  // 创建出一个随机颜色的div供我使用;
                  var fire = this.createFirework();//调用烟花创建函数
                  fire.style.left = offsetX + "px"; //烟花生成时离主体左边的距离
                  fire.style.bottom = 0;//烟花生成时在主体的最下边
                  this.main.appendChild(fire); //将生成的烟花插入到主体中
                  return fire;
            }
            createFirework(){//烟花创建函数
                  // 1.创建元素;\
                  var fire = document.createElement("div");//创建div
                  // 2. 运算;
                  fire.className = "firework";//改变class名
                  fire.style.background = getRandomColor();//调用随机颜色
                  // 3. 放入页面中;
                  // this.main.appendChild(fire);
                  return fire;
            }
        }
        new Firework();
            function $(selector){
                var ele = null;
                return (ele = document.querySelectorAll(selector)).length === 1 ? ele[0] : ele;
        }

            function getRandomColor(){//随机颜色函数
                  var r = Math.round(Math.random() * 255);
                  var g = Math.round(Math.random() * 255);
                  var b = Math.round(Math.random() * 255);
                  return "rgb(" + r + "," + g + "," + b + ")";
            }


            function move( dom , options , callback){ //运动框架
                  clearInterval( dom.timer );
                  dom.timer = setInterval( function(){
                        // console.log(1);
                        // 根据 attr 判定获取 iNow;
                        // 根据iNow 和 target 获取 speed;
                        // 根据target和 iNow 判定终止条件;
                        // 根据attr 判定 dom操作;
                        // * attr  target;
                        for(var attr in options){
                              // console.log(attr,options[attr]);
                              if( attr === "opacity"){
                                    var iNow = parseInt(getComputedStyle(dom)[attr] * 100 )
                              }else{
                                    var iNow = parseInt(getComputedStyle(dom)[attr])
                              }
                              // console.log(attr , iNow);
                              // target => options[attr];
                              var speed = (options[attr] - iNow) / 10;
                              speed = speed > 0 ? Math.ceil(speed):Math.floor(speed);

                              if(options[attr] === iNow){
                                    // 所有属性运动结束之后再去关闭定时器;
                                    delete options[attr];
                                    // console.log(options);
                                    // var count = 0;
                                    // for(var key in options){
                                    //       count ++;
                                    // }
                                    // if(count === 0){
                                    //       clearInterval(dom.timer);
                                    // }
                                    if(Object.keys(options).length === 0){
                                          clearInterval(dom.timer);
                                          typeof callback === "function" ? callback() : "";
                                    }
                              }else{
                                    if(attr === "opacity"){
                                          dom.style[attr] = (iNow + speed) / 100;
                                    }else{
                                          dom.style[attr] = iNow + speed + "px";
                                    }
                              }
                        }
                  } ,50)
            }
      

      </script>
</body>
</html>