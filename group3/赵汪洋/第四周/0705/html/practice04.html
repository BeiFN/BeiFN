<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>模板引擎</title>
</head>

<body>
    <script type="text/html" id="template1">
        <% for (var i = 0; i < 10; i++) { %> <h2>hello world</h2> <% } %>
    </script>
    <script type="text/html" id="template2">
        <% for (var i = 0; i < 10; i++) { %> <h2>hello world</h2>
        <~ } ~>
    </script>
    <script type="text/html" id="template3">
        for (var i = 0; i < 10; i++) { <% <h2>hello world</h2> %> }
    </script>
    <script type="text/javascript">
        // var template = document.getElementById("template");
        // var templateString = template.innerHTML;
        // // console.log(templateString);
        // var reg1 = /<%(.*?)%>/g;
        // var reg2 = /<~(.*?)~>/g;
        // var res = templateString.replace(reg1, `$1print(\``);
        // console.log(res);
        // res = res.replace(reg2, `\`);$1`);
        // // console.log(res);
        // // res = `print(\`${res}\`);`;
        // console.log(res);
        // var html = "";
        // function print(str) {
        //     html += str;
        // }
        // eval(res);
        // document.body.innerHTML = html;

        var template = document.getElementById("template2");
        var templateString = template.innerHTML;
        // console.log(templateString);
        var reg1 = /<%(.*?)%>/g;
        var reg2 = /<~(.*?)~>/g;
        var res = document.getElementById("template2").innerHTML.replace(reg1, `$1print(\``);
        console.log(res);
        res = res.replace(reg2, `\`);$1`);
        // console.log(res);
        // res = `print(\`${res}\`);`;

        // let res = document.getElementById("template3").innerHTML.replace(/<%(.*?)%>/g, `print(\`$1\`);`);
        
        let html = "";
        let print = str => html += str;
        eval(res);
        document.body.innerHTML = html;
    </script>
</body>

</html>