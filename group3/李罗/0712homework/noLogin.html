<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <form id="form">
                <p>用户名 : <input type="text" name="username" value="liluo"></p>
                <p>密  码 : <input type="text" name="password" value="123456"></p>
                <button id="btn">提交</button>
    </form>

    <script src="../0712/libs/utils.js"></script>
    <script>
        let {ajax,$}=utils.js;
        let [from,btn]=[
            $("#form"),
            $["#btn"]
        ];
        //阻止提交按钮的默认事件
        form.addEventListener("submit",evt=>{
            let e=evt || window.event;
            e.preventDefault();
        })

        btn.addEventListener("click",evt=>{
            let [
                userValue,
                pwdValue
            ]=[
                $("input[name=username]").value,
                $("input[name=password]").value,
            ]
            //禁用按钮；
            btn.disabled="disabled";
            btn.innerHTML="loading...";
            let url = "http://localhost/JS/0712homework/loginphp";
            let data={
                username:userValue,
                password:pwdValue
            }
            ajax(url,{
                data,
                type:"POST",
                dataType:"json"
            })
            .then(res=>{
                switch(res.stateCode){
                    case 0:alert("登录参数不全");break;
                    case 2 :  alert("数据库连接失败");break;
                    case 3 : alert("用户名不存在"); break;
                    case 4 : alert("密码错误"); break;
                    case 1 : alert("登陆成功");location.reload(); break;
                }
                btn.removeAttribute("disabled");
                btn.innerHTML="登录";
                console.log(res);
            })
        })
        //先发送一个请求，验证是否存在tocken码，如果存在就不用登录了，如果不存在就继续登录
        function validdateTocken(){
            
        }
    </script>
    
</body>
</html>