<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>委托的封装</title>
    <style>
            li{
                  list-style-type: none;
            }
            *{
                  margin: 0;
                  padding: 0;
            }

            li{
                  padding: 3px 5px;
                  border-bottom: 2px solid #ddd;
                  text-align: center;
                  width: 50%;
                  margin: 5px auto;
                  background: #fff;
            }
            ul{
                  background: #ddd;
            }
      
      </style>
</head>
<body>
    <ul id="list">
       <li class="li1">点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li class="li1">点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
       <li>点击触发事件</li>
    </ul>

    <script>
        // var ul=document.getElementById ("list");
        // ul.addEventListener("click",function(evt){
        //     //判断一下当前发生事件的事件源，是不是要绑定事件的元素
        //     var e=evt||window.event;
        //     var target=e.target||e.srcElement;
        //     //我们现在要求事件源：LI
        //     if(target.nodeName==="LI"){
        //         // console.log("我是事件源啊");
        //              target.style.background="yellow";
        //         handlerClick();
        //     }
        // })
        // function handlerClick(){
        //     console.log("我是事件源啊");
                
        // }

        //事件的委托封装=》封装判定
        //事件绑定不好传参：所以我们在函数内部返回一个函数=》delegation(匿名函数[用来判定是不是应该调用事件处理函数，事件执行的时候匿名函数会执行]，事件处理函数)

        // var ul=document.getElementById ("list");
        // ul.addEventListener("click",delegation(handlerClick,"LI"));
        // function delegation(handlerClick,selector){
        //     return function(evt){
        //         // console.log(this);
        //         var e=evt||window.event;
        //         var target=e.target||e.srcElement;
        //         // console.log("匿名函数",target);
        //         if(target.nodeName===selector){
        //             handlerClick.call(target,e);
        //         }
        //     }
        // }
        // function handlerClick(e){
        //     // console.log("事件执行",this,e);
        //     this.style.background="yellow";
        // }


        //优化一下呗
        var ul=document.getElementById("list");
        ul.addEventListener("click",delegation(handlerClick,".li1"));
        function delegation(handlerClick,selector){
            return function(evt){
                var eleList=this.querySelectorAll(selector);
                // console.log(eleList);
                var e=evt||window.event;
                var target=e.target||e.srcElement;
                var targetFamily=[];//声明一个数组装
                var _temp=target;
                var count=0;
                while(true&&count++<100){
                    if(_temp===this){
                        break;
                    }
                    targetFamily.push(_temp);
                    _temp=_temp.parentNode;
                }
                // console.log(targetFamily ,target) ;
                //判定target是不是在这个数组之中
                for(var i=0,ele;ele=eleList[i++];){
                    if(targetFamily.length===1?(target===ele):(targetFamily.indexOf(ele)!==-1)){
                        handlerClick.call(ele,e);
                        break;
                    }
                }
            }
        }

        function handlerClick(e){
            // console.log("事件执行",this,e);
            this.style.background="yellow";
        }

    </script>
    
</body>
</html>