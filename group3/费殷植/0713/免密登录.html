<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <form id="form">
        <p>用户名 : <input type="text" name="username" value="aa"></p>
        <p>密 码 : <input type="text" name="password" value="123"></p>
        <button id="btn">提交</button>
    </form>
    <script src="../libs/utils.js"></script>
    <script>
        //获取变量
        let { ajax, $, cookie } = Utils
        let [form, btn] = [$("#form"), $("#btn")]

        //阻止默认的表单提交刷新页面事件
        form.addEventListener("submit", function (evt) {
            let e = evt || window.event;
            //阻止默认事件
            e.preventDefault();
            // e.preventDefault?e.preventDefault():e.returnValue = false
        })
        //添加提交的点击事件    
        btn.addEventListener("click", function () {
            let [usr, pwd] = [$("input[name=username]"), $("input[name=password]")]
            //获取用户名和密码 然后通过ajax访问
            let url = "http://localhost/day24/login.php";
            btn.innerHTML = "loading..."
            btn.disabled = "true"
            ajax(url, {
                data: {
                    username: usr.value,
                    password: pwd.value,
                },
                type: "POST",
                dataType: "json"
            })
                .then(res => {
                    switch (res.stateCode) {
                        case 0:
                            alert("缺少参数");
                            break;
                        case 2:
                            alert("数据库连接失败")
                            break;
                        case 3:
                            alert("用户名不存在")
                            break;
                        case 4:
                            alert("密码错误")
                            break;
                        case 1:
                            alert("表示登陆成功");
                            break;
                    }
                    btn.removeAttribute("disabled")
                    btn.innerHTML = "提交"
                })
        })

        //免密登录

        function mianMi() {
            let url = "http://localhost/day24/login.php"
            ajax(url)
                .then(function (res) {
                    res = JSON.parse(res)
                    console.log(res.state+"1111")
                    if (res.state) {
                        return false;
                    }
                    console.log(res.state+"2222")
                    form.innerHTML = "用户名为:" + res.username + "<button id='exit'>退出登陆</button>";
                    exit = $("#exit")
                    //退出模块
                    // if (exit) {
                    //     console.log(exit)
                    //     exit.addEventListener("click", function () {
                    //         let url = "http://localhost/day24/login.php?close=true"
                    //         ajax(url)
                    //     })
                    // }
                })
        }

        mianMi();


    </script>
</body>

</html>