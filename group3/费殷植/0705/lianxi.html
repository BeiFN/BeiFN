<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<link rel="stylesheet" href="./styles/magnifier.css">
<body>
    <div class="container-magnifier">
        <div class="wrap-small-magnifier">
              <img src="./images/1.jpg" alt="">
              <div class="focus"></div>
              <div class="patch">
                    <!-- 其实这就是个贴膜 -->
              </div>
        </div>
        
        <div class="wrap-choice-magnifier">
              <i class="active"
                 data-big="./images/1.big.jpg"
                 data-small="./images/1.jpg"
              ><img src="./images/1.small.jpg" alt=""></i>
              <i
                data-big="./images/2.big.jpg"
                data-small="./images/2.jpg"
              ><img src="./images/2.small.jpg" alt=""></i>
        </div>
        <div class="wrap-big-magnifier">
              <img src="./images/1.big.jpg" alt="">
        </div>
  </div>
</body>
<script>
      function Magnifier(){
            this.Init()
            this.small_position=getAdsPosition(this.small)
            // this.bigImg_position=getAdsPosition(this.bigImg)
            this.small_size=getSize(this.small)
            this.smallImg_size=getSize(this.smallImg)
            this.focus_size=getSize(this.focus)
            this.big_size=getSize(this.big)
            this.bigImg_size=getSize(this.bigImg)
      }
      Magnifier.prototype.Init=function(){
            this.small=document.querySelector(".wrap-small-magnifier")
            this.smallImg=document.querySelector(".wrap-small-magnifier img")
            this.focus=document.querySelector(".wrap-small-magnifier .focus")
            this.big=document.querySelector(".wrap-big-magnifier")
            this.bigImg=document.querySelector(".wrap-big-magnifier img")
            this.choice=document.querySelector(".wrap-choice-magnifier")
            this.activeLi=Array.from(document.querySelectorAll(".wrap-choice-magnifier i"))
            this.activeImg=Array.from(document.querySelectorAll(".wrap-choice-magnifier i img"))
            this.bindEvent()
            console.log(this.activeImg);
            
      }
      Magnifier.prototype.bindEvent=function(){
            
            this.activeImg.forEach((element,index) => {
                  element.addEventListener("click",this.changeIndex.bind(this,index))
            });
            this.small.addEventListener("mouseenter",this.yellowEnter.bind(this))
            this.small.addEventListener("mouseleave",this.yellowLeave.bind(this))
            this.small.addEventListener("mousemove",this.yellowFollow.bind(this))
            // this.small.addEventListener("mousemove",this.bigMove.bind(this))
      }
      Magnifier.prototype.changeIndex=function(index){
            this.activeLi.forEach((element,index) => {
                  element.className=""
            });
            this.activeLi[index].className="active"
            this.smallImg.src=`./images/${index+1}.jpg`
      }
      Magnifier.prototype.yellowEnter=function(){
            this.focus.style.display="block";
            this.big.style.display="block";
      }
      Magnifier.prototype.yellowLeave=function(){
            this.focus.style.display="none";
            this.big.style.display="none";
      }
      Magnifier.prototype.yellowFollow=function(evt){
            var e=evt||window.event;
            var f_left=e.pageX-this.small_position.left-(this.focus_size.width)/2;
            var f_top=e.pageY-this.small_position.top-(this.focus_size.height)/2;
            var leftMax=this.small_size.width-this.focus_size.width;
            var topMax=this.small_size.height-this.focus_size.height;
            
            f_left=(f_left<=0?0:f_left);
            f_left=(f_left>=leftMax?leftMax:f_left);
            f_top=(f_top<=0?0:f_top);
            f_top=(f_top>=topMax?topMax:f_top);
            this.focus.style.left=f_left+"px";
            this.focus.style.top=f_top+"px";
            getRatio.call(this,f_left,f_top,leftMax,topMax)
      }
      Magnifier.prototype.bigMove=function(rX,rY){
            this.bigImg.style.left= - (this.bigImg_size.width-this.big_size.width)*rX+"px";
            this.bigImg.style.top= - (this.bigImg_size.height-this.big_size.height)*rY+"px";
      }
      function getRatio(x,y,lM,tM){
            var ratioX=x/lM
            var ratioY=y/tM
            this.bigMove.call(this,ratioX,ratioY)
      }
      function getSize(dom){
            return {
                  width:parseInt(getComputedStyle(dom)["width"]),
                  height:parseInt(getComputedStyle(dom)["height"])
            }
      }
      function getAdsPosition(dom){
            var position={
                  left: dom.offsetLeft,
                  top: dom.offsetTop
            }
            if(dom.offsetParent===document.body){
                  return position
            }else{
                  var pos=getAdsPosition(dom.offsetParent)
                  return {
                  left: dom.offsetLeft + pos.left,
                  top: dom.offsetTop + pos.top
                  }
            }
      }
      let magnifier= new Magnifier()
</script>
</html>