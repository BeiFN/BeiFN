<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
            #container{
                width: 600px;
                height: 400px;
                background: #000;
                border: 2px solid #f10;
                position: absolute;
                left: 0;
                top: 0;
                bottom: 0;
                right: 0;
                margin: auto;
            }      
            
            .firework{
                width: 7px;
                height: 7px;
                border-radius: 50%;
                background: #fff;
                position: absolute;
            }
    </style>
</head>
<body>
    <div id="container">
    </div>
    <Script src="../libs/common.js"></Script>
    <script>
        // 1.创建基本的框架   构造函数
        // 2.初始化init      绑定事件
        // 3.handlerFire    负责整个事件的耦合关系
        // 4.fierInit       烟花的初始化  插入烟花 烟花要有一个初始的位置
        // 5.creatfire      创建烟花  需要有随机颜色
        // 6.fireMove       移动烟花  移动完成之后需要删除烟花主题 并调用烟花爆炸函数
        // 7.creatBoom      
        // 8.boomMove       烟花炸掉的移动 

        let{randomColor,move} =  Utils;

        class Fireworks{
            constructor(){
                this.main = document.getElementById("container");
                this.init();
            }
            init(){
                this.main.addEventListener("click",this.handlerFireworks.bind(this));
            }
            handlerFireworks(evt){
                let e = evt || window.event;
                let offsetX = e.offsetX;
                let offsetY = e.offsetY;
                let fire = this.fireInit(offsetX);
                this.fireMove(offsetY,fire,this.fireBoom.bind(this,offsetX,offsetY));
            }
            fireInit(offsetX){
                let fire = this.creatFire();
                fire.style.left = offsetX + "px";
                fire.style.bottom = 0;
                this.main.appendChild(fire);
                return fire ;
            }
            creatFire(){
                let fire = document.createElement("div");
                fire.className = "firework";
                fire.style.background = randomColor();
                return fire;
            }

            fireMove(offsetY,fire,boomCallBack){
                move(fire,{
                    top  :  offsetY 
                },function(){
                    fire.remove();
                    boomCallBack();
                })
            }

            fireBoom(X,Y){
                let randomFires = 15  + Math.round(Math.random()*10);
                let blank = Math.round(360/randomFires);
                let r = 80 + Math.round(Math.random() * 100);
                let angle = 0; 
                for(let i = 0 ; i < randomFires ; i++){
                    angle += blank ; 

                    let fire_booms = this.creatFire();
                    fire_booms.style.left = X + "px";
                    fire_booms.style.top = Y + "px";  
                    this.main.appendChild(fire_booms);
                    
                    let fire_targerX = Math.round(Math.cos( Math.PI / 180 * angle ) * r + X); 
                    let fire_targerY = Math.round(Math.sin(Math.PI / 180 * angle) * r + Y);
                    // console.log( fire_targerX ,  fire_targerY)

                    move(fire_booms,{
                        left : fire_targerX ,
                        top : fire_targerY ,
                        opacity : 40 
                    },function(fire_booms){
                        fire_booms.remove();
                    }.bind(false,fire_booms))
                }
            }
        }
        new Fireworks();
    
    </script>
</body>
</html>