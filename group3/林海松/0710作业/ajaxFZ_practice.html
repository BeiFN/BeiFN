<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>AJAX初级封装</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        body,html{
            height: 100%;
            background: #f4f4f4;
        }
        .box{
            float: left;
            position: relative;
            background: #fff;
            margin: 0 20px 20px 0;
            overflow: hidden;
            border-radius: 4px;
        }
        .box img{
            width: 210px;
            height: 158px;
        }
        .title-box{
            width: 190px;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: justify;
            -ms-flex-pack: justify;
            justify-content: space-between;
            padding: 10px;
            display: -webkit-box;
            white-space: nowrap;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 1;
            overflow: hidden;
            text-overflow:ellipsis;
        }
        .container{
            width: 1150px;
            height: 223px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">

    </div>
    <script type="text/html" id="template">
        <% for(var attr in data ){ %>
            <div class="box">
                <img src="<%= data[attr].cover %>" alt="">
                <div class="title-box"><%= data[attr].title %></div>
            </div>
      <% } %>
    </script>
    <script src="./libs/ejs.js"></script>
    <script>
        // var xhr = new XMLHttpRequest();//创建对象
        // xhr.open("GET","http://localhost/0710/01ajax.txt");//建立http请求
        // xhr.send(null);//发送请求
        // xhr.onreadystatechange = function(){
        //     if(xhr.readyState === 4 && xhr.status === 200){
        //         document.body.innerHTML = xhr.responseText;
        //     }
        // }// 封装=>
        function ajax(url , callback ,type="GET"){
            var xhr = new XMLHttpRequest();
            xhr.open(type , url);
            xhr.send(null);
            xhr.onreadystatechange = function(){
                if(xhr.readyState === 4 && xhr.status === 200){
                    callback(xhr.responseText);//回应的内容
                }
            }
        }
        //若果url直接写网站的url，则会出先跨域错误
        // AJAX请求数据有限制；限制是浏览器给的
        // 同源策略：同端口，同协议，桶域名
        // 假数据 ； => 静态的JSON资源
        // ajax("http://localhost/0710/02json.json",function(res){
        //     var container = document.querySelector(".container");
        //     res = JSON.parse(res);//转为json格式
        //     //将数据放到模板中,转为HTML数据ejs.render(template, data);
        //     var res = ejs.render(document.getElementById("template").innerHTML,{data : res.data.contents});
        //     // console.log(res);
        //     container.innerHTML += res
        // })


        //清楚版
        ajax("http://localhost/0710/02json.json",function(res){
            var container = document.querySelector(".container");
                    //ejs.render(template, data);内容，数据
            var res = ejs.render(document.getElementById("template").innerHTML,{data : JSON.parse(res).data.contents});
            container.innerHTML += res;
        })
    </script>
</body>
</html>