<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>烟花</title>
    <style>
        #container{
            width:700px;
            height:500px;
            background-color: #000;
            border:3px solid red;
            position: absolute;
            top:0;
            bottom:0;
            left: 0;
            right: 0;
            margin:auto;
        }
        .fire{
            height:7px;
            width:7px;
            border-radius: 50%;
            position: absolute;
        }
    </style>
</head>
<body>
    <div id = "container"></div>

    <script>
    
//创建构造函数
    function Firework(selector){
        this.container = document.querySelector(selector);
        this.init();
}

//实例化，绑定事件,点击container创建div烟花
    Firework.prototype.init = function(){
        this.container.addEventListener("click" , this.handlerClick.bind(this));
    }

//处理点击事件，获取鼠标参数
    Firework.prototype.handlerClick = function(evt){
        var e = evt || window.event;
        var x = e.offsetX;
        var y = e.offsetY;
        var fire = this.startLocation(x);
        var sui = this.fireBoom.bind(this , x , y);
        // console.log(this);
        this.fireMove(
            fire , 
            {top : y},
            function(){
                fire.remove();//烟花上升后消失
                // console.log(this);
                sui();//烟花消失后执行烟花爆炸
        });
    }

// //烟花移动，包括上升移动和爆炸移动
//     Firework.prototype.fireMove = function(){
//         move(
//             fire,
//             {top : y},
//             function(){
//                 fire.remove();//烟花上升后消失
//             })
//     }

//创建div烟花
    Firework.prototype.createFirework = function(){
        var fire = document.createElement("div");
        fire.className = "fire";
        fire.style.background = randomColor();
        this.container.appendChild(fire);
        return fire;
    }

//设定烟花位置
    Firework.prototype.startLocation = function(x){
        var fire = this.createFirework();
        fire.style.left = x + "px";
        fire.style.bottom = 0;
        return fire;
    }
    

//烟花爆炸
    Firework.prototype.fireBoom = function(x , y){
        var fireflower = Math.round(Math.random() * 10) + 15;
        // console.log(fireflower);
        var blank = Math.round(360 / fireflower);
        var r = 100;
        angle = 0;
        for(i = 0;i < fireflower;i ++){
            angle += blank;
            var firefloweroffsetX = Math.round(Math.cos(Math.PI / 180 * angle) * r) + x;
            var firefloweroffsetY = Math.round(Math.sin(Math.PI / 180 * angle) * r) + y;
            // console.log(firefloweroffsetX,firefloweroffsetY);
            var fire = this.createFirework();
            fire.style.left = x + "px";
            // console.log(x,y);
            fire.style.top = y + "px";
            this.container.appendChild(fire);
            this.fireMove(
                fire ,
                {
                    left : firefloweroffsetX,
                    top :firefloweroffsetY
                },
                function(fire){
                    // fire.remove();
                }.bind(false,fire))
            }
        
    }

//移动框架
    Firework.prototype.fireMove = function (dom , options , callback){
        clearInterval(dom.timer)
        dom.timer = setInterval(function(){
            for(var attr in options){
                if(attr === "opacity"){
                    var iNow = parseInt(getComputedStyle(dom)[attr] * 100);
                }else{
                    var iNow = parseInt(getComputedStyle(dom)[attr]);
                }
            }
            var speed = (options[attr] - iNow) / 10;
            speed = speed > 0 ? Math.ceil(speed) : Math.floor(speed);
            if(options[attr] === iNow){
                delete options[attr];
                if(Object.keys(options).length === 0){
                    clearInterval(dom.timer)
                    typeof callback === "function" ? callback() : "";
                }
            }else{
                if(attr === "opacity"){
                    dom.style[attr] = (iNow + speed) / 100;
                }else{
                    dom.style[attr] = iNow + speed + "px";
                }
            }
        },50)
        
    }




//随机颜色
    function randomColor(){
        var r = Math.round(Math.random() * 255);
        var g = Math.round(Math.random() * 255);
        var b = Math.round(Math.random() * 255);
        return  "rgb(" + r + "," + g + "," + b + ")";
    }

//调用构造函数
    new Firework("#container");

    </script>


</body>
</html>