<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>楼梯</title>
    <style>
        *{
            margin : 0;
            padding : 0;
        }
        header{
            height: 500px;
            width:100%;
            background-color: #ddd;
            line-height: 500px;
            font-size: 100px;
            color : #fff;
            text-align: center;
        }
        div[class*=box]{
            height: 1000px;
            width:100%;
            /* border-bottom : 3px solid #666; */
            font-size: 100px;
            color: #000;
            line-height: 1000px;
            text-align: center;
        }
        footer{
            width : 100%;
            height: 500px;
            background-color: yellowgreen;
            line-height: 500px;
            color : #fff;
            font-size: 100px;
            text-align: center;
        }
        .stairs{
                /* width:100px;
                height:100px; */
            position: fixed;
            top: 50%;
            right: 50%;
            margin-right: 598px;
            -webkit-transform: translateY(-50%);
            -ms-transform: translateY(-50%);
            transform: translateY(-50%);
            padding: 0;
            background :pink;
            -webkit-box-shadow: 0 0 3px 0 #ddd;
            box-shadow: 0 0 3px 0 #ddd;
            z-index: 110;
            -webkit-transform: scale(0);
            -ms-transform: scale(0);
            transform: scale(0);
            visibility: hidden;
            -webkit-transition: all .2s linear;
            transition: all .2s linear; 
        }
        .stairs span{
            text-align: center;
            display: block;
            padding: 5px 10px;
            color: #666;
            -webkit-transition: all .2s linear;
            transition: all .2s linear;
            background: #f6f6f6;
            cursor: pointer;
        }
        .stairs span.active{
            color: #f10;
            font-weight: 700;
        }
        .show{
            -webkit-transform: scale(1);
            -ms-transform: scale(1);
            transform: scale(1);
            visibility: visible
        }
    </style>
</head>
<body>
    <header>我是头部</header>
    <div class="container">
        <div class="box1">1</div>
        <div class="box2">2</div>
        <div class="box3">3</div>
        <div class="box4">4</div>
        <div class="box5">5</div>
    </div>
    <footer>我是尾</footer>
    <div class="stairs">
        <span>一楼</span>
        <span>二楼</span>
        <span>三楼</span>
        <span>四楼</span>
        <span>五楼</span>
    </div>


    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
    <script>
        $(".container div").css({
            background : function(){
                var r = Math.round(Math.random() * 255);
                var g = Math.round(Math.random() * 255);
                var b = Math.round(Math.random() * 255);
                return "rgb(" + r + "," + g + "," + b + ")";
            }
        })

        function Stairs(){
            this.init();
        }

        $.extend(Stairs.prototype,{
            init : function(){
                this.header = $("header");
                this.stairs = $(".stairs");
                this.stair = this.stairs.children();
                this.header_height = {
                    height : this.header.height()
                }
                this.box = $("div[class*=box]");
                this.box_list = [];
                $.each(this.box,$.proxy(function(index,item){
                    var min = $(item).offset().top;
                    this.box_list.push({
                        min : min,
                        max : min + $(item).outerHeight()
                    })
                },this));
                //滚动事件
                var self = this;
                $(window).scroll($.proxy(function(){
                    var scroll_top = $("body,html").scrollTop();
                    // console.log(scroll_top);
                    this.showStairs(scroll_top);
                    this.changeStairs(scroll_top);
                },this))

                //点击楼梯楼层出现
                this.stairs.on("click","span",$.proxy(function(evt){
                    var target = evt.target;
                    this.changeFloor.call(this,$(target).index());
                    this.changeStairs($("body,html").scrollTop());
                },this))
            },
            //楼梯出现
            showStairs : function(scroll_top){
                // console.log(this.header_height.height);
                var has = this.stairs.hasClass("show");
                if(!has && scroll_top > this.header_height.height ){
                    // console.log(1);
                    this.stairs.addClass("show");
                }
                if(has && scroll_top < this.header_height.height){
                    this.stairs.removeClass("show");
                }
            },
            changeFloor : function(index){
                $("body,html").scrollTop(this.box.eq(index).offset().top);
            },
            //随滚动楼梯效果
            changeStairs : function(scroll_top){
                console.log(1);
                $.each(this.box_list,$.proxy(function(index,item){
                    if(item.min <= scroll_top && item.max >= scroll_top){
                        this.stair.eq(index).addClass("active")
                        .siblings()
                        .removeClass("active");
                    }
                },this));
            }
        })

        new Stairs();
    </script>
</body>
</html>