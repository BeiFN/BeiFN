<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        header{
            height: 150px;
            background: red;
            font-size: 100px;
            line-height: 150px;
            color: #fff;
            text-align: center;
        }
        .player{
            width: 640px;
            margin: 0 auto;
        }
        .player img{
            display: block;
            height: 1000px;
            width: 640px;
            box-sizing: border-box;
            border: 5px solid #ddd; 
        }
        footer{
            background:#E00;
            height: 600px;
        }
        .stairs{
                  position: fixed;
                  top: 30%;
                  right: 50%;
                  margin-right: 550px;
                  -webkit-transform: translateY(-50%);
                  -ms-transform: translateY(-50%);
                  transform: translateY(-50%);
                  padding: 0;
                  background: #fff;
                  -webkit-box-shadow: 0 0 3px 0 #ddd;
                  box-shadow: 0 0 3px 0 #ddd;
                  z-index: 110;
                  -webkit-transform: scale(0);
                  -ms-transform: scale(0);
                  transform: scale(0);
                  visibility: hidden;
                  -webkit-transition: all .2s linear;
                  transition: all .2s linear;
                  
            }
            .stairs span{
                  display: block;
                  padding: 5px 10px;
                  color: #666;
                  -webkit-transition: all .2s linear;
                  transition: all .2s linear;
                  background: #f6f6f6;
                  cursor: pointer;
            }
            .stairs span.active{
                  color: #f10;
                  font-weight: 700;
            }
            .show{
                  -webkit-transform: scale(1);
                  -ms-transform: scale(1);
                  transform: scale(1);
                  visibility: visible
            }
        
    </style>
</head>
<body>
    <header>灌篮高手</header>
    <div class="player">
        <img src="https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=1852246686,1575042101&fm=173&app=25&f=JPEG?w=640&h=1006&s=E906419ACE122FFD1F8DD3B003004015" alt="" class="yingmu">
        <img src="https://ss2.baidu.com/6ONYsjip0QIZ8tyhnq/it/u=3863866415,2897407341&fm=173&app=25&f=JPEG?w=636&h=1000&s=F1105B94404272E63538D1DD030010E2" alt="" class="liuchuan">
        <img src="https://ss2.baidu.com/6ONYsjip0QIZ8tyhnq/it/u=1951724687,3464967347&fm=173&app=25&f=JPEG?w=636&h=1000&s=20419843C81837DC490C0DBA03001011" alt="" class="sanjing">
        <img src="https://ss2.baidu.com/6ONYsjip0QIZ8tyhnq/it/u=2368266350,2883511655&fm=173&app=25&f=JPEG?w=636&h=1000&s=5713578F8363EAEC3E08ADEF0300802B" alt="" class="chimu">
        <img src="https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=3227339433,2302120083&fm=173&app=25&f=JPEG?w=636&h=1000&s=97A0FBA120639BF1544C5C2C0300A044" alt="" class="gongcheng">

    </div>
    <footer></footer>
    <div class="stairs">
        <span>樱木花道</span>
        <span>流川枫</span>
        <span>三井寿</span>
        <span>赤木刚宪</span>
        <span>宫城良田</span>

    </div>
    <script src="./jquery.js"></script>
    <script src="./utils.js"></script>
    <script>
        //防抖
        let {throttle} = Utils;
        function Stairs(){
            this.init();
        }
        $.extend(Stairs.prototype,{
            init : function(){
                this.header = $("header");
                this.headerSize = {
                    height : this.header.height()
                };
                this.stairs = $(".stairs");
                this.imgs    = $("img");
                console.log(this.imgs);
                this.stairsList = this.stairs.children();
                this.imgList = [];//包含最大最小值
                $.each(this.imgs,$.proxy(function(index,item){
                    var min = $(item).offset().top; //offset 与 position
                    this.imgList.push({
                        min :min,
                        max : min + $(item).outerHeight()
                    })
                },this)); //this指向jQuery；
                console.log(this.imgList);
                var self= this;
                //事件处理，根据scrolltop确定楼梯上的显示
                $(window).scroll(throttle($.proxy(function(){
                    //兼容写法获取scrollTop
                    var st = $("body,html").scrollTop();
                    // console.log(1);
                    this.toggeleStairs(st);
                    this.changeStairs(st);
                },this),300));  //节流
                //鼠标点击stairs，去到对应的scolltop位置
                this.stairs.on("click","span",$.proxy(function(evt){
                    var target = evt.target;
                    console.log(target);
                    this.changeFloor.call(this,$(target).index());//获取事件源下标
                    this.changeStairs($("body,html").scrollTop());
                },this))
               

                },
                //楼梯的显示及隐藏
                toggeleStairs: function ( st ){
                   console.log(st,this.headerSize.height);
                    var has = this.stairs.hasClass("show");
                    if(!has&&st>this.headerSize.height){
                        console.log(1);
                        this.stairs.addClass("show");
                    }
                    if(has&&st<this.headerSize.height){
                        this.stairs.removeClass("show");
                    }
                },
                changeFloor : function(index){
                    //将scolltop设为点击的span所对应楼层的offsettop
                    $("html,body").scrollTop(this.imgs.eq(index).offset().top);
                    console.log(8);
                },
                changeStairs: function(scrollTop){
                    //进入范围后，符合的span所对应的index变色，其余删除类名
                    $.each(this.imgList,$.proxy(function(index,item){
                        if(scrollTop>=item.min&&scrollTop<item.max){
                            this.stairsList.eq(index).addClass("active")
                            .siblings()
                            .removeClass("active");
                        }
                    },this))
                }


            

        })
        new Stairs();
    </script>
    
</body>
</html>