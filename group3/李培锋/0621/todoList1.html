<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /> 
		<title>ToDoList—最简单的待办事项列表</title>
		<meta name="description" content="ToDoList无须注册即可使用，数据存储在用户浏览器的html5本地数据库里，是最简单最安全的待办事项列表应用！" />
        <style>
            body {margin:0;padding:0;font-size:16px;background: #CDCDCD;}
            header {height:50px;background:#333;background:rgba(47,47,47,0.98);}
            section{margin:0 auto;}
            label{float:left;width:100px;line-height:50px;color:#DDD;font-size:24px;cursor:pointer;font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;}
            header input{float:right;width:60%;height:24px;margin-top:12px;text-indent:10px;border-radius:5px;box-shadow: 0 1px 0 rgba(255,255,255,0.24), 0 1px 6px rgba(0,0,0,0.45) inset;border:none}
            input:focus{outline-width:0}
            h2{position:relative;}
            span{position:absolute;top:2px;right:5px;display:inline-block;padding:0 5px;height:20px;border-radius:20px;background:#E6E6FA;line-height:22px;text-align:center;color:#666;font-size:14px;}
            ol,ul{padding:0;list-style:none;}
            li input{position:absolute;top:2px;left:10px;width:22px;height:22px;cursor:pointer;}
            p{margin: 0;}
            li p input{top:3px;left:40px;width:70%;height:20px;line-height:14px;text-indent:5px;font-size:14px;}
            li{height:32px;line-height:32px;background: #fff;position:relative;margin-bottom: 10px;
                padding:0 45px;border-radius:3px;border-left: 5px solid #629A9C;box-shadow: 0 1px 2px rgba(0,0,0,0.07);}
            ol li{cursor:move;}
            ul li{border-left: 5px solid #999;opacity: 0.5;}
            li a{position:absolute;top:2px;right:5px;display:inline-block;width:14px;height:12px;border-radius:14px;border:6px double #FFF;background:#CCC;line-height:14px;text-align:center;color:#FFF;font-weight:bold;font-size:14px;cursor:pointer;}
            footer{color:#666;font-size:14px;text-align:center;}
            footer a{color:#666;text-decoration:none;color:#999;}
            @media screen and (max-device-width: 620px) {section{width:96%;padding:0 2%;}}
            @media screen and (min-width: 620px) {section{width:600px;padding:0 10px;}}
        </style>
	</head>
	<body>
		<header>
			<section>
                        <label for="title">ToDoList</label>
                        <input type="text" id="title" name="title" placeholder="添加ToDo" required="required" autocomplete="off" />
			</section>
		</header>
		<section>
			<h2>正在进行 <span id="todocount">0</span></h2>
			<ol id="todolist" class="demo-box">
			</ol>
			<h2>已经完成 <span id="donecount">0</span></h2>
			<ul id="donelist">

			</ul>
		</section>
        <script>
            function $(selector){                                                                               //统一选择器
                var ele= null;
                return( ele = document.querySelectorAll(selector)).length===1?ele[0]:ele;  }                     //采用querySelector当返回值为nodelist伪数组；当我们需要选择单一元素时，返回的是长度为一，当我们需要选取多个元素生成伪数组时，返回它本身，            }
            var ele_input = $("#title");
            var ele_todoList = $("#todolist");
            var ele_doneList = $("#donelist");
            var ele_todoCount = $("#todocount");
            var ele_doneCount = $("#donecount");
            function addTodoItem(){                                     //从输入框到todo：1.获取输入内容，2.生成元素3.定义事件
                var iptValue = ele_input.value;
                var li = createElement({                                //所需创立的li模板
                    type : "li",
                    children : [
                        {
                            type : "input",
                            attr :{
                                type:"checkbox",
                            }
                        },
                        {
                            type : "p",
                            html : iptValue
                        },
                        {
                            type : "a",
                            html : "-",
                        },
                    ]
                   
                })
                li.children[0].onchange = handlerTodoToDone;                        //todo的input的checked属性发生变化时，将其移入 done            
                li.children[2].onclick  = removeItem;                               //当a被点击时，删除
                ele_todoList.insertBefore(li.ele_todoList.childNodes[0]);           //函数被调用时生成所需结构的li，置于列表最前；
                countLi();
            }
            function handlerTodoToDone(){                                                            //todo的input的checked属性发生变化时，将其父节点移入 done                                      
                if(this.checked){
                    ele_doneList.insertBefore(this.parentNode,ele_doneList.childNodes[0]);
                }else{
                    ele_todoList.insertBefore(this.parentNode,ele_todoList.childNodes[0]);
                }
                countLi();
            }
            function removeItem(){                                                        //将调用者的父节点删除
                this.parentNode.remove();
                countLi();
            }
            function countLi(){                                                           //计数：当每次有事件发生后，通过计算两个伪数组的长度，来计算
                var doneCount = ele_doneList.children.length;
                var todoCount = ele_todoList.children.length;
                ele_todoCount.innerHTML = todoCount;
                ele_doneCount.innerHTML = doneCount;
            }

            function createElement(domJson){                                                //通过传入daojson来创建元素
                typeof domJson === "undefined"?domJson = {} : "";                           //？？
                var ele = document.createElement(domJson.type?domJson.type:"div");          //通过type key的存在与否创建为对应类型元素
                for(var attr in domJson.attr){                                              //遍历 key：attr 的key来创建属性
                    ele.setAttribute(attr,domJson.attr[attr]);
                }
                ele_innerHTML = domJson.html? domJson.html:"";                              //文本属性
           
            for(var i = 0,childEle;domJson.children&&(childEle=domJson.children[i++]);) {                           //判断 key：children存在，它的内部key若有type类型，则生成对应元素    
                childEle.nodeType === 1?ele.appendChlid(childEle):ele.appendChlid(createElement(childEle));

            }
            return ele;
        }
        ele_input.onkeydown = function(evt){
            var e = evt||event;
            if(e.keyCode===13){
                addTodoItem();
                ele_input.select();
            }
        }

        
        
        </script>
        
        
	</body>
</html>