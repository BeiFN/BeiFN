<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Document</title>
      <style>
            #container{
                  width: 600px;
                  height: 400px;
                  background: #000;
                  border: 2px solid #f10;
                  position: absolute;
                  left: 0;
                  top: 0;
                  bottom: 0;
                  right: 0;
                  margin: auto;
            }      
            
            .firework{
                  width: 7px;
                  height: 7px;
                  border-radius: 50%;
                  background: #fff;
                  position: absolute;
            }
      </style>
</head>
<body>
      <div id="container">
      </div>
      <script>
            // 1. 创造随机颜色的div的功能;
            // 2. 上升功能;
            // 3. 爆炸功能;

            // 构造函数储存属性
            function Firework(selector){
                this.main = document.querySelector(selector);
                // 判断参数是否为null
                if(this.main === null){
                    return false;
                }
                // 给原型方法初始化
                this.init();
            }

            // 原型上储存方法
            Firework.prototype.init = function(){
                this.main.addEventListener("click",this.handlerClickFire.bind(this));
            }
            // 在main内添加方法
            Firework.prototype.handlerClickFire = function (evt){
                var e = evt || event;
                var offsetx = e.offsetX;      //获取x坐标
                var offsety = e.offsetY;      //获取y坐标
                // console.log(x,y)              
                var fire = this.creatDiv(offsetx);
                this.fireworkMove(fire,offsety,this.fireworkBomb.bind(this,offsetx,offsety));
            }
            // 创建一个烟花
            Firework.prototype.creatDiv = function (offsetx){
                var fire = document.createElement("div");       //创建一个烟花-div
                    fire.className = "firework";                //添加样式
                    fire.style.bottom = 0 + "px";
                    fire.style.left = offsetx + "px";
                    fire.style.backgroundColor = "#"+Math.round(Math.random()*parseInt("ffffff",16)).toString(16).padStart(6,0);
                    this.main.appendChild(fire);                //添加到main中
                    return fire;
            }
            // 设置烟花在屏幕上移动
            Firework.prototype.fireworkMove = function(fire,offsety,fireworkBomb){
                move(fire,{
                    top : offsety
                },function(){
                    // 到达目标点时，移出烟花
                    fire.remove();
                    // 爆炸特效
                    fireworkBomb();
                });
            }
            // 烟花爆炸特效
            Firework.prototype.fireworkBomb = function (offsetx,offsety){
                // console.log(offsetx,offsety);           //获取烟花的坐标
                // console.log("爆炸");
                var firenum = 10 + Math.round(Math.random() * 10);      //烟花个数
                var blank   = 360 / firenum;                            //烟花间隔
                var r       = 50 + Math.round(Math.random() * 50);      //烟花半径
                var angle   = 0;                                        //起始角度
                for(var i=0;i<firenum;i++){                             //循环添加每一个烟花
                    angle += blank;                                     //每次角度增加
                    var fire_targetX = Math.round(Math.cos( Math.PI / 180 * angle ) * r + offsetx); 
                    var fire_targetY = Math.round(Math.sin( Math.PI / 180 * angle ) * r + offsety); 
                    var fireBomb = this.creatDiv();                     //每次循环添加一个烟花
                    fireBomb.style.left = offsetx + "px";               //起始坐标x
                    fireBomb.style.top  = offsety + "px";               //起始坐标y
                    this.main.appendChild(fireBomb);                    //添加到main中
                    move(
                        fireBomb,
                        {
                            left : fire_targetX,
                            top  : fire_targetY,
                            // opacity : 0      //烟花颜色，变透明
                        },
                        function(fireBomb){     //回调函数，改变this指向，删除烟花
                            fireBomb.remove();
                        }.bind(false,fireBomb)
                    );
                }
            }
            // move运动框架
            function move(dom,obj,fn){
            clearInterval(dom.timer);
            dom.timer = setInterval(function(){
                for(var attr in obj){
                    if(attr === "opacity"){
                        var iNow = parseInt(getComputedStyle(dom)[attr]*100);
                    }else{
                        var iNow = parseInt(getComputedStyle(dom)[attr]);
                    }
                    var speed = (obj[attr] - iNow) / 10;
                    speed = speed > 0 ? Math.ceil(speed):Math.floor(speed);
                    if(obj[attr] === iNow){
                        if(Object.keys(obj) === null){
                            clearInterval(dom.timer);
                        }
                        if(typeof(fn) === "function"){
                            fn();
                        }
                    }else{
                        if(attr =="opacity"){
                            dom.style.opacity =(iNow + speed)/100;
                        }else{
                            dom.style[attr] = (iNow + speed) + "px";
                        }
                    }
                }
            },50);
        }
            var firework = new Firework("#container");
                
      </script>
</body>
</html>