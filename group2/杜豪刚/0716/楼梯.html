<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>楼梯</title>
      <style>
            *{
                  margin: 0;
                  padding: 0;
            }
            .header,.footer{
                  height: 500px;
                  font-size: 100px;
                  color: #fff;
                  line-height: 500px;
                  text-align: center;
            }
            div[class*=box]{
                  height: 600px;
                  box-sizing: border-box;
                  color: #fff;
                  font-size: 100px;
                  line-height: 600px;
                  text-align: center;
            }
            .stairs{
                  position: fixed;
                  top: 50%;
                  right: 50%;
                  margin-right: 598px;
                  -webkit-transform: translateY(-50%);
                  -ms-transform: translateY(-50%);
                  transform: translateY(-50%);
                  padding: 0;
                  background: #fff;
                  -webkit-box-shadow: 0 0 3px 0 #ddd;
                  box-shadow: 0 0 3px 0 #ddd;
                  z-index: 110;
                  -webkit-transform: scale(0);
                  -ms-transform: scale(0);
                  transform: scale(0);
                  visibility: hidden;
                  -webkit-transition: all .5s linear;
                  transition: all .5s linear;
                  border-radius:5px;
            }
            .stairs span{
                  display: block;
                  padding: 5px 10px;
                  color: #666;
                  -webkit-transition: all .2s linear;
                  transition: all .2s linear;
                  background: #f6f6f6;
                  cursor: pointer;
            }
            .stairs span.active{
                  color: #f10;
                  font-weight: 700;
            }
            .show{
                  -webkit-transform: scale(1);
                  -ms-transform: scale(1);
                  transform: scale(1);
                  visibility: visible
            }
      </style>
</head>
<body>
      <div class="header">header</div>
      <div class="content">
            <div class="box1">1</div>
            <div class="box2">2</div>
            <div class="box3">3</div>
            <div class="box4">4</div>
            <div class="box5">5</div>
      </div>
      <div class="footer">footer</div>
      <div class="stairs">
            <span>楼梯链接 1 </span>
            <span>楼梯链接 2 </span>
            <span>楼梯链接 3 </span>
            <span>楼梯链接 4 </span>
            <span>楼梯链接 5 </span>
      </div>

      <script src="js/jquery.js"></script>
      <script src="js/utils.js"></script>
      <script>

        // 楼梯功能;
        // 1. 按钮显示隐藏;
        // 2. 点击改变scrollTop 功能;
        // 3. 根据scrollTop 改变楼层;

        // 每一个 div 随机颜色
        let { throttle }= Utils;
        $("div").css({
            background : function(){
                return "#"+(Math.round(Math.random()*parseInt("ffffff",16))).toString(16).padStart(6,0);
            }
        });

        function Stairs(){
            this.init();
        }
        $.extend(Stairs.prototype,{
            init:function(){
                this.header = $(".header");
                this.stairs = $(".stairs");
                this.boxs   = $("div[class*=box]");
                this.stairsChildren = this.stairs.children();
                // 定义一个空数组
                this.boxsList = [];
                $.each(this.boxs,$.proxy(function(index,item){
                    // console.log(item,index,this);
                    let min = $(item).offset().top;
                    this.boxsList.push({
                        min : min,
                        max : min + $(item).outerHeight(),
                    });
                    // console.log(this.boxsList);
                },this));
                // 当页面滚动的时候
                $(window).scroll(throttle($.proxy(function(){
                    // console.log(1);
                    let str = $("body,html").scrollTop();
                    // console.log(str)
                    this.scrollStairs(str);
                    this.changeStairs(str);
                },this),100));
                // 获取当前下标
                this.stairs.on("click","span",$.proxy(function(evt){
                    let target = evt.target ; 
                    // console.log($(target).index())
                    this.changeFloor.call(this,$(target).index());
                },this))
            },
            // 当页面滚动时，楼梯显示/隐藏
            scrollStairs : function(str){
                // console.log(this.header.height())
                let has = this.stairs.hasClass("show");
                if(!has && str >= this.header.height()){
                    // console.log(this.header.height(),str)
                    // 显示
                    this.stairs.addClass ("show");
                }
                if(has && str <= this.header.height()-200){
                    this.stairs.removeClass("show");
                }
            },
            // 点击楼层改变scrollTop
            changeFloor:function(index){
                $("html,body").scrollTop(this.boxs.eq(index).offset().top);
                // console.log(index)
            },
            // 根据scrollTop改变active
            changeStairs : function(str){
                // 循环遍历
                $.each(this.boxsList,$.proxy(function(index,item){
                    // console.log(item)
                    if(str >= item.min && str < item.max){
                        this.stairsChildren.eq(index).addClass("active")
                        .siblings()
                        .removeClass("active")
                    }
                },this))

            },
        })   

        new Stairs();
        
      </script>
</body>
</html>