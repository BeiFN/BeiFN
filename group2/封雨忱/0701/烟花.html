<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
     #container{
                  width: 600px;
                  height: 400px;
                  background: #000;
                  border: 2px solid #f10;
                  position: absolute;
                  left: 0;
                  top: 0;
                  bottom: 0;
                  right: 0;
                  margin: auto;
            }      
            
            .firework{
                  width: 7px;
                  height: 7px;
                  border-radius: 50%;
                  background: #fff;
                  position: absolute;
            }
    </style>
</head>
<body>
        <div id="container">
            </div>
    <script>
    function Firework(){
        this.main=document.getElementById('container');
        if(this.main===null){return false}
        // this.init();
    }
    Firework.prototype.init=function(){
        this.main.addEventListener('click',this.hanlderFireClick.bind(this))
    }

    //总体
    Firework.prototype.hanlderFireClick=function(evt){
        var e=evt||window.event;
        var offsetX=e.offsetX;
        var offsetY=e.offsetY;
        var fire=this.fireInit(offsetX);
        this.fireMove(fire,offsetY,this.fireBoom.bind(this,offsetX,offsetY))
    }

    //插入
    Firework.prototype.fireInit=function(offsetX){
        var fire=this.creatFire()
        fire.style.left=offsetX+'px';
        fire.style.bottom=0
        this.main.appendChild(fire);
        return fire;
    }
    //创建
    Firework.prototype.creatFire=function(){
        var fire=document.createElement('div');
        fire.className="firework";
        fire.style.background=changColor();
        // console.log(fire)
        return fire;
    }
    //向上移动
    Firework.prototype.fireMove=function(fire,offsetY,fireBoom){
        move(fire,
            {
                top: offsetY
            },
            function () {
                fire.remove();
                fireBoom();
            })
    }
    //爆炸
    Firework.prototype.fireBoom=function(offsetX,offsetY){
        // console.log(this)
        // console.log(offsetX,offsetY)
        //创建爆炸div
        var randomFireCount=15+Math.round(Math.random()*10);
        var blank=Math.round(360/randomFireCount)
        var r=100+Math.round(Math.random()*100);//半径
        var angle=0;//角度
        for(var i=0;i<randomFireCount;i++){
            angle+=blank;
            var fire_targetX=Math.round(Math.cos((Math.PI/180)*angle)*r+offsetX);
            var fire_targetY=Math.round(Math.sin((Math.PI/180)*angle)*r+offsetY);
            var fire_boom=this.creatFire()
            // console.log(fire_boom)
            fire_boom.style.left=offsetX+'px';
            fire_boom.style.top=offsetY+'px'
            this.main.appendChild(fire_boom);
            move(fire_boom,{
                left:fire_targetX,
                top:fire_targetY
            },function(fire_boom    ){
                fire_boom.remove();
            }.bind(false,fire_boom))
        }
    }
    //改变颜色
    var changColor=function(){
        var r=Math.round(Math.random()*255);
        var g=Math.round(Math.random()*255);
        var b=Math.round(Math.random()*255);
        return "rgb("+r+","+g+","+b+")";
    }
//运动函数
    function move( dom , options , callback){
                  clearInterval( dom.timer );
                  dom.timer = setInterval( function(){
                        // console.log(1);
                        // 根据 attr 判定获取 iNow;
                        // 根据iNow 和 target 获取 speed;
                        // 根据target和 iNow 判定终止条件;
                        // 根据attr 判定 dom操作;
                        // * attr  target;
                        for(var attr in options){
                              // console.log(attr,options[attr]);
                              if( attr === "opacity"){
                                    var iNow = parseInt(getComputedStyle(dom)[attr] * 100 )
                              }else{
                                    var iNow = parseInt(getComputedStyle(dom)[attr])
                              }
                              // console.log(attr , iNow);
                              // target => options[attr];
                              var speed = (options[attr] - iNow) / 10;
                              speed = speed > 0 ? Math.ceil(speed):Math.floor(speed);

                              if(options[attr] === iNow){
                                    // 所有属性运动结束之后再去关闭定时器;
                                    delete options[attr];
                                    // console.log(options);
                                    // var count = 0;
                                    // for(var key in options){
                                    //       count ++;
                                    // }
                                    // if(count === 0){
                                    //       clearInterval(dom.timer);
                                    // }
                                    if(Object.keys(options).length === 0){
                                          clearInterval(dom.timer);
                                          typeof callback === "function" ? callback() : "";
                                    }
                              }else{
                                    if(attr === "opacity"){
                                          dom.style[attr] = (iNow + speed) / 100;
                                    }else{
                                          dom.style[attr] = iNow + speed + "px";
                                    }
                              }
                        }
                  } ,50)
            }
    var x=new Firework();
    x.init();
    </script>            
</body>
</html>