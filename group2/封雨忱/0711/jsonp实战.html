<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
        <input type="text" id="ipt">
        <div id="content">
        <script>
            // function foo(res){
            //     console.log(res)
            // }
            // document.onclick=function(){
            //     var script=document.createElement("script");
            //     script.src="http://127.0.0.1/0711/jsonp.php";
            //     document.body.appendChild(script);
            //     script.onload=function(){
            //         this.remove();
            //     }
            // }

            //封装
                // function jsonp(url,cb_fild,callback){
                //     var GLOBAL_CB="foo"
                //     window[GLOBAL_CB]=function(res){
                //         callback(res);
                //     }
                //     var script=document.createElement('script');
                //     url+= (/\?/).test(url)?"&":"?";
                //     script.src=url+cb_fild+"="+GLOBAL_CB;
                //     script.onload=function(){
                //         this.remove();
                //     }
                //     document.body.appendChild(script);
            
                // }
                // jsonp("http://127.0.0.1/0711/jsonp_1.php","callback",function(res){
                //     alert(res);
                // })

                function jsonp(url, cb_fild, data) {
                        return new Promise(function (resolve, reject) {
                            var GLOBAL_CB = "foo"
                            window[GLOBAL_CB] = function (res) {
                                resolve(res);
                            }
                            var script = document.createElement('script');
                            url += ((/\?/).test(url) ? "&" : "?")+ cb_fild + "=" + GLOBAL_CB;;
                            if(typeof data==="object"){
                                let dataStr="";
                                for(let attr in data){
                                    dataStr += (dataStr.length > 0 ? "&" : "") + attr + "=" + data[attr];
                                }
                                url+="&"+dataStr;
                            }
                            script.src = url ;
                            script.onload = function () {
                                this.remove();
                            }
                            document.body.appendChild(script);
                        });
                    }
                    var data={wd:""}
                    var ipt=document.getElementById('ipt');
                    var content=document.getElementById('content');
                    ipt.oninput=function(){
                        data.wd=this.value;
                        jsonp("https://www.baidu.com/sugrec?pre=1&p=3&ie=utf-8&json=1&prod=pc&from=pc_web&sugsid=1451,21092,20698,29523,29518,29238,28519,29098,28837,29220,26350,29071&wd=ajs&req=2&csor=3&pwd=aj&_=1562836035866","cb",data)
                    .then(function(res){
                        console.log(res);
                        let html="";
                        res.g.forEach(item=>html+=`<p>${item.q}</p>`)
                        content.innerHTML=html
                    })
                    }
                    

                </script>
</body>
</html>