<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        #box {
            width: 600px;
            height: 400px;
            background: #000;
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
        }

        .firework {
            height: 8px;
            width: 8px;
            border-radius: 50%;
            position: absolute;
        }
    </style>
</head>

<body>
    <div id="box">
    </div>
</body>
<script>
    class Firework {

        constructor({
            selector="#box"
        }= {}) {
            this.box = document.querySelector(selector);
            if (this.box === null) {
                return false;
            }
            this.init();
        }

        init() {
            this.box.addEventListener("click", this.createFireWorkInit.bind(this));
        }

        createFireWorkInit(evt) {
            var e = evt || event;
            var offsetX = e.offsetX;
            var offsetY = e.offsetY;
            var fire = this.fireWorkInit(offsetX);
            this.fireWorkMove(offsetY, fire, this.fireWorkBoom.bind(this, offsetX, offsetY));
        }

        fireWorkBoom(offsetX, offsetY) {
            var boomNum = 15 + Math.round(Math.random() * 10);
            var angel = 0;
            var r = 100 + Math.round(Math.random() * 100);
            var blank = Math.round(360 / boomNum);
            for (var i = 0; i < boomNum; i++) {

                angel += blank;

                var fireoffsetX = Math.round(Math.cos(Math.PI / 180 * angel) * r + offsetX);
                var fireoffsetY = Math.round(Math.sin(Math.PI / 180 * angel) * r + offsetY);
                var fireBoom = this.createFireWork();
                fireBoom.style.left = offsetX + "px";
                fireBoom.style.top = offsetY + "px";
                this.box.appendChild(fireBoom);
                move(fireBoom, {
                    left: fireoffsetX,
                    top: fireoffsetY,
                    opacity: 0,
                }, function (fireBoom) {
                    fireBoom.remove();
                }.bind(false, fireBoom))
            }
        }

        fireWorkMove(offsetY, fire, boomCallBack) {
            move(fire, {
                top: offsetY,
            }, function () {
                fire.remove();
                boomCallBack();
            });
        }

        fireWorkInit(offsetX) {
            var fire = this.createFireWork();
            fire.style.left = offsetX + "px";
            fire.style.bottom = 0;
            this.box.appendChild(fire);
            return fire;
        }

        createFireWork() {
            var fire = document.createElement("div");

            fire.className = "firework";
            fire.style.background = randomColor();
            return fire;
        }


        static randomColor() {
            var r = Math.round(Math.random() * 255);
            var g = Math.round(Math.random() * 255);
            var b = Math.round(Math.random() * 255);

            return "rgb(" + r + "," + g + "," + b + ")";
        }


        static move(dom, list, fireCallBack) {
            clearInterval(dom.timer);
            dom.timer = setInterval(function () {
                for (var attr in list) {
                    if (attr === "opacity") {
                        var iNow = parseInt(getComputedStyle(dom)[attr] * 100);
                    } else {
                        var iNow = parseInt(getComputedStyle(dom)[attr]);
                    }

                    var speed = (list[attr] - iNow) / 10;
                    speed = speed > 0 ? Math.ceil(speed) : Math.floor(speed);

                    if (list[attr] === iNow) {
                        delete list[attr];
                        if (Object.keys(list).length === 0) {
                            clearInterval(dom.timer);
                            fireCallBack();
                        }
                    } else {
                        if (attr === "opacity") {
                            dom.style.opacity = (iNow + speed) / 100;
                        } else {
                            dom.style[attr] = iNow + speed + "px";
                        }
                    }
                }
            }, 50)
        }
    }

    new Firework();
    let{randomColor,move} = Firework;
</script>

</html>