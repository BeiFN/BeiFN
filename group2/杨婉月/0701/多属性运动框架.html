<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">   
    <title>Document</title>
    <style>
        #box{
            width:100px;
            height:100px;
            background:#000;
        }
    </style>
</head>
<body>
    <div id="box"></div>

    <script>
    
    var box = document.getElementById("box");
    move(box, {
        "opacity":20,
        "height":400,
        "width":400
    })

    function move(dom, options, callback){
        //dom : 运动的节点
        //options : 属性对象
        //callback : 回调函数

        //关闭定时器
        clearInterval(dom.timer);

        dom.timer = setInterval(function(){
            //遍历options中所有的对象
            for(var attr in options){

                //得到当前的属性值
                //如果是透明度，当前透明度应该乘100
                if(attr === "opacity"){
                    var iNow = parseInt(getComputedStyle(dom)[attr]*100);
                    //getComputedStyle(dom)[attr]是小数  必须先乘100然后再取整，否则iNow为0
                    //为什么要取整？？？
                    //如果不取整，则会在最后不断闪
                    console.log("iNow", iNow);
                }
                else{
                    iNow = parseInt(getComputedStyle(dom)[attr]);
                }
                //计算当前速度：（目标点值-当前属性值）/任意一个整数
                speed = (options[attr]-iNow)/10;
                //对当前速度取整
                speed > 0 ? Math.ceil(speed) : Math.floor(speed);

                //当所有当前属性值等于目标点值时关闭定时器
                if(options[attr]===iNow){
                    //如何做到当所有属性运动结束后再关闭定时器？？？
                    //到达一个，删除一个
                    delete options[attr];
                    //当options中无对象时，关闭定时器
                    if(Object.keys(options).length===0){
                        clearInterval(dom.timer);
                        //在运动结束之后，执行回调函数
                        //判断是否为函数
                       typeof callback === "function"? callback() : "";
                    }
                }else{
                    if(attr === "opacity"){
                        dom.style[attr] = (iNow + speed)/100;
                    }
                    else{
                        dom.style[attr] = iNow + speed + "px";
                    }
                }
            }
        }, 50)
    }

    </script>

</body>
</html>