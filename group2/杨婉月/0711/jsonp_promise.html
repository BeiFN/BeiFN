<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
        <input type="text" id="ipt">
        <div id="content">
</body>
<script>
    //常规jsonp封装
    // function jsonp(url, call_name, callback, data){
    //     //全局函数
    //     //全局函数名 foo
    //     var global_name = "foo";
    //     window[global_name] = function(){
    //         callback(res);
    //     }
    //     //拼接url的参数字符串
    //     if(typeof data === "object"){
    //         var data_str = "";
    //         for(var attr in data){
    //             data_str += (data_str.length>0 ? "&": "") + attr + "=" + "data[attr]";
    //         }
    //         url += (/\?/.test(url)? "&" : "?") + data_str;
    //     }

    //     //创建srcipt
    //     var _script = document.createElement("script");
    //     _script.src = url;
    //     _script.onload = function(){
    //         this.remove();
    //     }
    //     document.body.append(_script);
    // }


    //promise + json封装
    function jsonp(url, call_name, data){
        return new Promise(function(resolve, reject){
            //全局函数
            //全局函数名 foo
            var global_name = "foo";
            window[global_name] = function(res){
                resolve(res);
            }
            //url后拼接callback名
            url += (/\?/.test(url) ? "&" : "?")+ call_name + "=" + global_name;
            //拼接url的参数字符串
            if(typeof data === "object"){
                var data_str = "";
                for(var attr in data){
                    data_str += (data_str.length>0 ? "&": "") + attr + "=" + data[attr];
                }
                // url += (/\?/.test(url)? "&" : "?") + data_str;
                url += (url.indexOf("?") == -1 ? "?" : "&") + data_str;
            }

            //创建srcipt
            var _script = document.createElement("script");
            _script.src = url;
            _script.onload = function(){
                this.remove();
            }
            document.body.append(_script);
        })
        
    }

    var url = "https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su";

            var data = {
                  json:1 ,
                  p:3,
                  sid:1423_21080_29238_28518_29099_28830_29221_22158,
                  req:2,
                  sc:"eb",
                  csor:0,
                  _:Date.now(),
                  wd : ""
            }

    var ipt = document.getElementById("ipt");
            var content = document.getElementById("content");

            ipt.oninput = function(){
                  // console.log(this.value);
                  data.wd = this.value;
                  jsonp( url , "cb" , data)
                  .then( function (res){
                        // console.log(res);
                        var html = "";
                        res.s.forEach( item => html += `<p>${item}</p>`);
                        content.innerHTML = html;
                  })
            }


</script>
</html>