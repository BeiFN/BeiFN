<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        *{
            margin:0;
            padding:0;
        }
        .header, .footer{
            height: 500px;
            width:100%;
            text-align: center;
            line-height: 500px;
            font-size: 30px;
            border-bottom: 10px solid slategray;
        }

        .box{
            height: 500px;
            width:100%;
            text-align: center;
            line-height: 500px;
            font-size: 30px;
            border-bottom: 10px solid slategray;
        }
        .left_nav{
            position:fixed;
            left:30px;
            bottom: 30px;
            display: none;
        }
        .n_item{
            width:80px;
            height:50px;
            border:teal solid 3px;
            text-align: center;
            line-height: 50px;
        }
        .active{
            background:azure;
            font-weight: 700;
        }

    </style>
</head>
<body>
    <div class="header">头部</div>
    <div class="boxList">
        <div class="box">1</div>
        <div class="box">2</div>
        <div class="box">3</div>
        <div class="box">4</div>
        <div class="box">5</div>
        <div class="box">6</div>
    </div>
    
    <div class="footer">尾部</div>

    <div class="left_nav">
        <div class="n_item active">1</div>
        <div class="n_item">2</div>
        <div class="n_item">3</div>
        <div class="n_item">4</div>
        <div class="n_item">5</div>
        <div class="n_item">6</div>
        <div class="n_item">TOP</div>
    </div>
</body>

<script src="../libs/jquery-1.8.0.js"></script>
<script>
    function Floor(){
        this.init();
    }

    $.extend(Floor.prototype, {
        //初始化
        init : function(){
            //获取header的高度
            this.header_height = $(".header").height();
            //获取所有的模块
            this.boxAll = $(".boxList").children();
            //获取左侧导航条
            this.left_nav = $(".left_nav");
            this.navAll = this.left_nav.children();
            //存放最大值、最小值的数组
            this.boxArray = [];
            //遍历所有的模块，将最大值和最小值存入
            
            //index在前，ele在后!!!!
            //一定要用proxy，因为有匿名函数!!!!
            $(this.boxAll).each($.proxy(function(index , ele){
                //最小值等于模块的top值
                //ele格式为$(ele)!!!!
                let min = $(ele).offset().top;
                //最大值等于模块的top值+模块高度
                let max = min + $(ele).outerHeight();
                this.boxArray.push({min, max});
            }, this))
            // console.log(this.boxArray);
            //绑定事件
            // let st = document.documentElement.scrollTop || document.body.scrollTop;
            // console.log(st);
            // this.showNav(st);
            $(window).on("scroll", $.proxy(function(){
                let st = document.documentElement.scrollTop || document.body.scrollTop;
                // console.log(st);
                this.showNav(st);
                this.changeNav(st);
            }, this));  //一定要指定this!!!!!
            this.left_nav.on("click", $(".n_item"), $.proxy(function(e){
                let target = e.target;
                this.changeBox.call(this, $(target).index());
            }, this))
        },

        //显示左侧导航条
        //不要忘了传参数
        showNav : function(st){
            if(this.header_height<=st){
                // console.log(1);
                this.left_nav.css({
                    display : "block"
                })
            }
            else if(this.header_height>st){
                // console.log(2);
                this.left_nav.css({
                    display : "none"
                })
            }
        },
        changeNav : function(st){
            //根据当前滚动的距离来计算在哪个模块的区间内
            $(this.boxArray).each($.proxy(function(index, ele){
                // console.log(ele.min);
                if(st>=ele.min && st<ele.max){
                    console.log(index);
                    console.log(this.navAll.eq(2));
                    this.navAll.eq(index).addClass("active")
                    .siblings().removeClass("active");
                }
            }, this))
        },
        changeBox : function(index){
            $("html,body").scrollTop(this.boxAll.eq(index).offset().top);
        }
    })

    new Floor();

</script>
</html>