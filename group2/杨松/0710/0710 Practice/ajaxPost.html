<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Document</title>
      <style>
            *{
                  margin: 0;
                  padding: 0;
            }
            body,html{
                  height: 100%;
                  background: #f4f4f4;
            }
            .box{
                  float: left;
                  position: relative;
                  background: #fff;
                  margin: 0 20px 20px 0;
                  overflow: hidden;
                  border-radius: 4px;
                  -webkit-border-radius: 4px;
                
            }
            .box img{
                  width: 210px;
                  height: 158px;
            }
            .title-box{
                  width: 190px;
                  display: -webkit-box;
                  display: -ms-flexbox;
                  display: flex;
                  -webkit-box-align: center;
                  -ms-flex-align: center;
                  align-items: center;
                  -webkit-box-pack: justify;
                  -ms-flex-pack: justify;
                  justify-content: space-between;
                  padding: 10px;
                  display: -webkit-box;
                  white-space: nowrap;
                  -webkit-box-orient: vertical;
                  -webkit-line-clamp: 1;
                  overflow: hidden;
                  text-overflow:ellipsis;


            }
            .container{
                  width: 1150px;
                  height: 223px;
                  margin: 0 auto;
    
            }
      </style>
</head>
<body>
      <div class="container"></div>
      <script src="./libs/ejs.js"></script>
      <script type="text/html" id="template">
            <% for(var attr in data ){ %>
                  <div class="box">
                        <img src="<%= data[attr].cover %>" alt="">
                        <div class="title-box"><%= data[attr].title %></div>
                  </div>
            <% } %>
      </script>
      <script>   
            function ajax(url,{
                  // callback = (res) => {},
                  type = "GET",
                  data = {},
                  contentType = "application/x-www-form-urlencoded"
            }={}){
                  // 订阅者名单
                  // 只要有观察者订阅就会往里面放函数
                  // 等数据下载完成返回结果时，发布信息给观察者
                  let list = [];
                  let str = "";
                  for(let attr in data){
                        str += `${(str.length > 0 ? "&" : " ")}${attr} = ${data[attr]}`;
                  }
                  let xhr = new XMLHttpRequest();
                  xhr.open(type,url + `${type == "GET" ?(/\?/.test(url) ? "&" : "?") + str : " "}`);
                  type == "GET" ? "":xhr.setRequestHeader("Content-type" , contentType);
                  xhr.send(type == "GET" ? null:str);
                  xhr.onreadystatechange = function(){
                        if(xhr.readyState == 4 && xhr.status ==200){
                              // 
                              // callback(xhr.responseText);
                              for(let attr in list){
                                    list[attr](xhr.responseText);
                              }
                        }
                  }
                  return{
                        add:function(){
                              list = list.concat(Array.from(arguments));
                              return list;
                        }
                  }
            }
            //地址更改
            ajax("http://localhost/0710/0710%20Practice/json.json",{
                  // callback : function(res){
                  //       console.log(res);
                  // },
                  type:"GET",
                  data:{
                        username:"xiedawen",
                        password:"1234565"
                  }
            }).add(function(res){
                  console.log(res);
                  res = JSON.parse(res);
                  let container = document.getElementById(".container");
                  let re = ejs.render(document.getElementById("template").innerHTML,{data:res.data.contents});
                  document.body.innerHTML = re;
            },function(res){
                  console.log("第二个");
            })
      </script>
</body>
</html>