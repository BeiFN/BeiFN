<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #wrap{width: 600px;height: 600px;background: #000;border: 2px solid #f10;position: absolute;left: 0;top: 0;bottom: 0;right: 0;margin: auto;}
        .firework{width: 7px;height: 7px;border-radius: 50%;background: #fff;position: absolute;}
    </style>
</head>
<body>
<div id="wrap"></div>
<script>
    function Firework(selector){
        this.main = document.querySelector(selector);
        if(this.main == null) return false;
    }
    Firework.prototype.init = function (){
      this.main.addEventListener("click" ,this.handlerFireClick.bind(this))
    };
    Firework.prototype.handlerFireClick = function (e) {
        var e = e || event ;
        var target = e.target || e.srcElement;
        var offsetX = e.offsetX;
        var offsetY = e.offsetY;
        var fire = this.fireworkInit(offsetX);

        this.fireworkMove(fire,offsetY,this.fireworkBlast.bind(this,offsetX,offsetY));
    };
    Firework.prototype.fireworkBlast=function(offsetX,offsetY){
        var randomFireworkCount = 15 + Math.round(Math.random()*10);
        var white = Math.round (360/randomFireworkCount);
        var r =100 +Math.round(Math.random()*100);
        var angle =0;
        for(var i=0 ;i<randomFireworkCount;i++){
            angle += white;
            var fire_X = (Math.round(Math.cos(Math.PI/180*angle)*r) + offsetX);
            var fire_Y = (Math.round(Math.sin(Math.PI/180*angle)*r) +offsetY);
            var fire_blast = this.createFirework();
            fire_blast.style.left = offsetX + "px";
            fire_blast.style.top = offsetY +"px";
            this.main.appendChild(fire_blast);
            // move(fire_blast,{
            //     left : fire_X,
            //     top :fire_Y,
            //     opacity:0.5
            // })
            move(fire_blast,{
                left : fire_X,
                top  : fire_Y ,
                opacity:0.3
            },function(fire_blast){
                fire_blast.remove();
            }.bind(false,fire_blast))
        }
    };

    Firework.prototype.fireworkMove=function(fire,offsetY,blastCallback){
        move(fire,{
            top :offsetY

        },function () {
            fire.remove();
            blastCallback();
        })
    };
    Firework.prototype.fireworkInit=function(offsetX) {
        var fire = this.createFirework();
        fire.style.left = offsetX + 'px';
        fire.style.bottom = 0;
        this.main.appendChild(fire);
        return fire;

    };
    Firework.prototype.createFirework =function () {
        var fire =document.createElement("div");
        fire.className = 'firework';
        fire.style.background = getRandomColor();
        return fire;
    };

    function getRandomColor() {
        var r = Math.round(Math.random() * 255);
        var g = Math.round(Math.random() * 255);
        var b = Math.round(Math.random() * 255);
        return "rgb(" + r + "," + g + "," + b + ")";
    }



    var fire = new Firework("#wrap");
    fire.init();

    function move( dom , options , callback){
        clearInterval( dom.timer );
        dom.timer = setInterval( function(){
            // console.log(1);
            // 根据 attr 判定获取 iNow;
            // 根据iNow 和 target 获取 speed;
            // 根据target和 iNow 判定终止条件;
            // 根据attr 判定 dom操作;
            // * attr  target;
            for(var attr in options){
                // console.log(attr,options[attr]);
                if( attr === "opacity"){
                    var iNow = parseInt(getComputedStyle(dom)[attr] * 100 )
                }else{
                    var iNow = parseInt(getComputedStyle(dom)[attr])
                }
                // console.log(attr , iNow);
                // target => options[attr];
                var speed = (options[attr] - iNow) / 10;
                speed = speed > 0 ? Math.ceil(speed):Math.floor(speed);

                if(options[attr] === iNow){
                    // 所有属性运动结束之后再去关闭定时器;
                    delete options[attr];
                    // console.log(options);
                    // var count = 0;
                    // for(var key in options){
                    //       count ++;
                    // }
                    // if(count === 0){
                    //       clearInterval(dom.timer);
                    // }
                    if(Object.keys(options).length === 0){
                        clearInterval(dom.timer);
                        typeof callback === "function" ? callback() : "";
                    }
                }else{
                    if(attr === "opacity"){
                        dom.style[attr] = (iNow + speed) / 100;
                    }else{
                        dom.style[attr] = iNow + speed + "px";
                    }
                }
            }
        } ,50)
    }

</script>
</body>

</html>