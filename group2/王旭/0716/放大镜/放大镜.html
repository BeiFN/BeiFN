<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Document</title>
      <style>
            *{
                  margin: 0;
                  padding: 0;
            }
            .container{
                  width: 350px;
                  height: 450px;
                  position: relative;
                  margin-left: 20px;
            }
            .small-img{
                  width : 350px;
                  height: 350px;
                  position: relative;
                  box-shadow: 0 0 10px #000;
            }
            .small-img img{
                  width: 100%;
                  height: 100%;
            }
            .cube{
                  width: 100px;
                  height: 100px;
                  position: absolute;
                  z-index: 1;
                  left: 0;
                  top: 0;
                  display: none;
                  background-image: url(https://upload-images.jianshu.io/upload_images/16960494-32836970433a5d75.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240);
                  background-repeat: no-repeat;
                  background-size: 350px 350px;
                  background-position: 0 0 ;                  
            }
            .big-img{
                  width: 300px;
                  height: 300px;
                  position: absolute;
                  left: 350px;
                  top: 0;
                  box-shadow: 0 0 10px #000;
                  overflow: hidden;
                  display: none;
            }
            .big-img img{
                  width: 1050px;
                  height: 1050px;
                  position: absolute;
            }

            .img-btn{
                  padding-top: 20px;
                  width: 100%;
                  height: 100px;
            }
            .img-btn .img-box{
                  width: 60px;
                  float: left;
                  border: 3px solid rgba(0,0,0,0);
                  overflow: hidden;
            }
            .img-btn .img-box.active{
                  border-color: red;
            }
            .img-btn .img-box:hover{
                  border-color: red;
            }
            .img-btn .img-box img{
                  width  : 100%;
                  height : 100%;
            }
           
      </style>
</head>
<body>

      
      <div class="container">  
            <div class="small-img">
                  <img src="https://upload-images.jianshu.io/upload_images/16960494-32836970433a5d75.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">
                  <div class="cube"></div>
            </div>
            <div class="big-img">
                  <img src="https://upload-images.jianshu.io/upload_images/16960494-927c81e490e2e3ea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">
            </div>
            <div class="img-btn">
                  <div class="img-box active">  
                        <img src="https://upload-images.jianshu.io/upload_images/16960494-6016305427ecad9f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">
                  </div>
                  <div class="img-box">
                        <img src="https://img10.360buyimg.com/n1/s450x450_jfs/t29947/237/504683383/325948/366d1176/5bf51182N3574dbb3.jpg" alt="">
                  </div>
            </div>
      </div>
      <!-- <script src="./javascripts/index.js"></script> -->
      <script src="../../libs/jquery.js"></script>
      <script>
      
       
function Magnifier(){
    this.init();
}
Magnifier.prototype = {
    constructor : Magnifier,
    constructor : function(){
        this.small_wrapper  = this.$(".small-img");
        this.small_img      = this.$(".small-img img");
        this.cube           = this.$(".cube");

        //大图部分
        this.big_wrapper  = this.$(".big-img");
        this.big_img      = this.$(".big-img img");

        //切图按钮
        this.img_btn_wrapper = this.$(".img-btn");
        this.img_btn = this.img_btn_wrapper.children;

        this.small_wrapper_position = this.getAbsPosition(this.small_wrapper);
        this.small_cube_size        = this.getSize(this.cube);
        this.small_wrapper_size     = this.getSize(this.small_wrapper);
        this.big_img_size           = this.getSize(this.big_img);
        this.big_wrapper_size       = this.getSize(this.big_wrapper);


        this.list = [
            {
                small_src : "https://upload-images.jianshu.io/upload_images/16960494-32836970433a5d75.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",
                big_src   : "https://upload-images.jianshu.io/upload_images/16960494-927c81e490e2e3ea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"
            },{
                small_src : "https://img10.360buyimg.com/n1/s450x450_jfs/t29947/237/504683383/325948/366d1176/5bf51182N3574dbb3.jpg",
                big_src   : "https://img14.360buyimg.com/n0/jfs/t29947/237/504683383/325948/366d1176/5bf51182N3574dbb3.jpg"
            }
        ]
    }
}
$.extend(Magnifier.prototype,{

    init : function(){
        $(this.small_wrapper).on("mouseenter",$.proxy(show,this));
        $(this.small_wrapper).on("mouseleave",$.proxy(hide,this));
        $(this.small_wrapper).on("mousemove",$.proxy(handlerMousemove,this));

        $(this.img_btn_wrapper).on("click",this.delegation(this.changeImg.bind(this),".img-box"));
    },

    //切换图片
    changeImg : function(evt,ele,index){
        $.each(this.img_btn,$.proxy(function(item){
            item.removeClassName("active");
        },this))
        // for(var i = 0,btn ; btn = this.img_btn[i++];){
        //     this.removeClassName(btn,"active");  
        // }
        //console.log(this.list[index-1].small_src,this.list[index-1].big_src);
        ele.className += " active";
        this.cube.style.backgroundImage = "url(" + this.list[index-1].small_src + ")";
        this.small_img.src =  this.list[index-1].small_src  ;
        this.big_img.src  = this.list[index-1].big_src  ;
    },


    //移入显示图片
    show : function(){
        this.cube.style.display        = "block";
        this.big_wrapper.style.display = "block";
        this.small_img.style.opacity   = 0.3;
    },

    //移出隐藏图片
    hide :function(){
        this.cube.style.display        = "none";
        this.big_wrapper.style.display = "none";
        this.small_img.style.opacity   = 1;
    },

    //cube跟随鼠标移动
   move : function(cube_position,big_img_position){
        this.cube.style.left = cube_position.x + "px";
        this.cube.style.top  = cube_position.y + "px";
        this.cube.style.backgroundPosition = -cube_position.x + "px " + -cube_position.y + "px";

        this.big_img.style.left = -big_img_position.x +"px";
        this.big_img.style.top  = -big_img_position.y + "px"; 
    },

    handlerMousemove : function(evt){
        var e = evt || event;
        var x = e.pageX - this.small_wrapper_position.left - this.small_cube_size.width  / 2;
        var y = e.pageY - this.small_wrapper_position.top  - this.small_cube_size.height / 2;
        var cube_position = this.boundary(x,y);
        var big_img_position = this.getBigPosition(x,y);
        this.move(cube_position,big_img_position);
    },

    //边界检测
    boundary : function(x,y){
        x = x < 0 ? 0 : x;
        var maxX = this.small_wrapper_size.width -this.small_cube_size.width;
        x = x >= maxX ? maxX : x;
        
        y = y <= 0 ? 0 : y;
        var maxY = this.small_wrapper_size.height - this.small_cube_size.height ;
        y = y >= maxY ? maxY : y;

        return {
            x : x,
            y : y
        }
    },

    //根据比例计算大图的位置
    getBigPosition : function(x,y){
        var propX     = x/(this.small_wrapper_size.width - this.small_cube_size.width);
        var big_img_x = parseInt(propX * (this.big_img_size.width - this.big_wrapper_size.width));
        var propY     = y/(this.small_wrapper_size.height - this.small_cube_size.height);
        var big_img_y = parseInt(propY * (this.big_img_size.height - this.big_wrapper_size.height));

        return {
            x : big_img_x,
            y : big_img_y 
        }
    },


    getAbsPosition : function(dom){
        var position = {
            left : dom.offsetLeft,
            top  : dom.offsetTop
        }
        if(dom.offsetParent === document.body){
            return position;
        }else{
            var pos = this.getAbsPosition(dom.offsetParent);
            return {
                left : dom.offsetLeft + pos.left,
                top  : dom.offsetTop  + pos.top
            }
        }
    },

    getSize : function(dom){
        return {
            width  : parseInt(getComputedStyle(dom)["width"]),
            height : parseInt(getComputedStyle(dom)["height"])
        }
    },

    // $(selector){
    //     var ele = null;
    //     return (ele = document.querySelectorAll(selector)).length === 1 ? ele[0] : ele;
    // }

    removeClassName : function(dom,className){
        return dom.className = dom.className.replace(new RegExp("\S?"+className),"");
    },
    delegation : function( handlerClick , selector ){
        return function(evt){
            var e = evt || window.event;
            var target = e.target || e.srcElement;
            var eleList = this.querySelectorAll(selector);
            var targetFamily = [];
            var _tempTarget = target;
            var count = 0;
            while(true && count ++ < 100){
                    if(_tempTarget === this || _tempTarget === null){
                        break;
                    }
                    targetFamily.push(_tempTarget);
                    _tempTarget = _tempTarget.parentNode;
            }
            for(var i = 0 , ele ; ele = eleList[i++]; ){
                    if(targetFamily.length === 1 ? ele === targetFamily[0] : targetFamily.indexOf(ele) !== -1){
                        handlerClick.call(ele , e , ele,i);
                        break;
                    }
            }
        }
    }
})

new Magnifier();

      </script>
</body>
</html>
</body>
</html>