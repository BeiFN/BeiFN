<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        body{
              background: #000;
        }
        #container{
              width: 600px;
              height: 400px;
              position: absolute;
              left: 0;
              top: 0;
              right: 0;
              bottom: 0;
              margin: auto;
              background: #fff;
        }
        #ball{
              width: 40px;
              height: 40px;
              background: radial-gradient(#09f,#f19);
              border-radius: 50%;
              position: absolute;
              left: 100px;
              top: 0;
        }
        .mask{
              width: 100%;
              height: 100%;
              position: absolute;
              left: 0;
              top: 0;
              z-index: 999;
        }
        .progress{
              width: 20px;
              height: 200px;
              overflow: hidden;
              position: absolute;
              bottom: 0;
              left: 0;
              border-radius: 0 2px 2px 0;
        }
        #progress-bar{
              height: 200px;
              width: 20px;
              background:top linear-gradient(yellowgreen,#f10);
              border-radius: 0 2px 2px 0;
        }
  </style>
</head>
<body>
    <div id="container">
        <div class="mask"></div>
        <div id="ball"></div>
        <div class="progress">
              <div id="progress-bar"></div>
        </div>
    </div>
    <script>
        var container = document.getElementById("container");;
        var ball = document.getElementById("ball");
        var _bar = document.getElementById("progress-bar");
        var timer = null;
        var target = 400;
        var moving = false;
        var speed = 20 ;
        var g =  0.5;
        var speedx = 0;

        document.addEventListener("click",ballDown);
        container.addEventListener("mousemove",ballMove);

        function ballMove(evt){
            var e = evt || event;
            if(!moving){
                ball.style.left = e.offsetX - 20 + "px";
                ball.style.top = e.offsetY - 20 + "px";
            }
            ballLeft(e.offsetX);
        }
        function ballLeft(x){
            if(x <= 300){
                        // console.log("向左");
                        var prop = (300 - x) / 300 * 100
                        speedX = - 5 * (prop / 100);

                  }else{
                        var prop = (x - 300) / 300 * 100;
                        speedX =   5 * (prop / 100);

                  }
                  // console.log(prop);
                  _bar.style.height = prop + "px";
        }
        function ballDown(){
            //clearInterval(timer);
            //removeEventListener("mousemove",ballMove);
            moving = true;
            clearInterval(timer);
            timer = setInterval(function(){
                
                speed += g;
                if(ball.offsetLeft <= 0 || ball.offsetLeft >= 600 - 40){
                    speedX = -speedX;
                    ball.style.left = ball.offsetLeft + speedX + "px"; 
                }else{
                    ball.style.left = ball.offsetLeft + speedX + "px"; 
                }
                if(ball.offsetTop <= 0){
                    speed = -speed;
                    ball.style.top = ball.offsetTop + speed + "px";
                    
                }else{
                    ball.style.top = ball.offsetTop + speed + "px";
                    if(Math.abs(target - 40 - ball.offsetTop) <= speed){
                        ball.style.top = target - 40 + "px";
                        speed = -speed;                   
                        if(speed >= -1){
                            clearInterval(timer);
                        }                      
                    }
                }
                
            },50)
        }
    </script>

</body>
</html>