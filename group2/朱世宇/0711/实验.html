<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script>
        function ajax(url , data, type="GET"){
            return new Promise( function(resolve , reject){
                  var xhr = null;
                  if(XMLHttpRequest){
                        xhr = new XMLHttpRequest();
                  }else{
                        xhr = new ActiveXObject("Mricosoft.XMLHTTP");
                  }
                  if(xhr === null) throw "浏览器不支持ajax";

                  var dataStr = "";
                  for(var attr in data){
                        dataStr += (dataStr.length > 0 ? "&" : "") + attr + "=" + data[attr];
                  }

                  type === "GET" ? url += (/\?/.test(url) ? "&" : "?") + dataStr : "";

                  xhr.open( type ? type : "GET" , url );
                  type === "POST" ? xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded"): "";
                  xhr.send( type === "POST" ? dataStr : null );
                  xhr.onreadystatechange = function(){
                        if(xhr.readyState === 4 && xhr.status === 200){
                              resolve(xhr.responseText);
                        }
                  }

                  // 设置超时;
                  setTimeout(function(){
                        reject(xhr,"timeout");
                  },8000)
            })
      }
      ajax("jsonp.php",{callback:"asd"}).then(res => {
          console.log(res);
      })
    </script>
</body>
</html>