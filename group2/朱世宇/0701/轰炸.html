<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>轰炸</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        #box{
            width: 800px;
            height: 500px;
            border: 3px dashed rgb(163, 211, 212);
            border-radius: 10px;
            position: fixed;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            margin:auto;
            background: #000;
            padding: 10px;
            overflow: hidden;
        }
        .missile{
            width: 5px;
            height: 5px;
            background: #000;
            position: absolute;
            border-radius: 100%;
        }
    </style>
</head>
<body>
    <div id="box">

    </div>
</body>
    <script src="libs/common.js"></script>
    <script>
        //OOA
        //目标：点击显示一个轰炸效果
        //炸弹就绪 投掷炸弹 定点轰炸 范围式伤害 
        //OOD
        function Bomb(){}
        Bomb.prototype.init = function(box){
            this.box = box;
            this.bindEvent(); 
        }
        Bomb.prototype.bindEvent = function(){
            this.box.addEventListener('click',this.prepare.bind(this));
            this.box.addEventListener('click',this.fail.bind(this));
        }
        Bomb.prototype.prepare = function(evt){
            let e = evt || window.event;
            let div = document.createElement('div');
            div.className = 'missile';
            div.style.background = this.randomColor();           
            div.style.left = e.offsetX + 'px';
            this.box.appendChild(div);
            this.bomb = div;
            clearInterval();
            return div;
        }
        Bomb.prototype.randomColor = function(){
                  let [r,g,b,a] = [
                                    Math.round(Math.random() * 255),
                                    Math.round(Math.random() * 255),
                                    Math.round(Math.random() * 255),
                                    (5 + Math.round(Math.random() * 5)) / 10
                               ]
                  return `rgba(${r},${g},${b},${a})`;
            }
        Bomb.prototype.fail = function(evt){
            let e = evt || window.event;
            let bomb = this.bomb;
            let offsetX = e.offsetX;
            let offsetY = e.offsetY > parseInt(parseInt(getComputedStyle(this.box)['height']) - parseInt(getComputedStyle(bomb)['height'])/2) ? parseInt(parseInt(getComputedStyle(this.box)['height']) - parseInt(getComputedStyle(bomb)['height'])/2):e.offsetY;
            move(bomb,{
                        top : offsetY
                  },this.spreadTo.bind(this,bomb,offsetX,offsetY));
        }
        Bomb.prototype.spreadTo = function(bomb,offsetX,offsetY){
            bomb.remove();
            let[a,count,duration] = [200 + Math.round (Math.random() *120 ),28,(5 + Math.round(Math.random() * 20)) / 10]
            for(let i = 0; i++<count;){
                let ele = this.prepare({offsetX});
                ele.style.top = offsetY + 'px';
                setTimeout(()=>{
                    ele.style.transition = `all ${duration}s`;
                    angle = Math.round( 360 / count * i);
                    let ele_x = a * Math.sin( count*(Math.PI / 180 * angle))*Math.cos(Math.PI / 180 * angle);
                    let ele_y = a * Math.sin( count*(Math.PI / 180 * angle))*Math.sin(Math.PI / 180 * angle);
                    ele.style.left = ele_x + offsetX + "px";
                    ele.style.top = ele_y  + offsetY+ "px";
                },50)

                setTimeout(()=>{
                              ele.remove();
                        },duration * 1000)
            }
        }
        Bomb.prototype.autoPlay = function(delay){

            this.delay = delay ? delay : 2000;

            let position = {
                offsetX : Math.round(Math.random() * 800),
                offsetY : Math.round(Math.random() * 600)
            }
            this.prepare(position);
            this.fail(position);

            // 一种写法;
            setTimeout(this.autoPlay.bind(this),this.delay)
            }
        var box = document.getElementById('box');
        var bomb = new Bomb();
        bomb.init(box);
        bomb.autoPlay(2000);
    </script>
</html>