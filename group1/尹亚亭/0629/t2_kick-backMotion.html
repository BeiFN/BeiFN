<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>重力回弹运动</title>
		  <style>
            body{
                  background: #000;
            }
            #container{
                  width: 600px;
                  height: 400px;
                  position: absolute;
                  left: 0;
                  top: 0;
                  right: 0;
                  bottom: 0;
                  margin: auto;
                  background: #fff;
            }
            #ball{
                  width: 40px;
                  height: 40px;
                  background: radial-gradient(#09f,#f19);
                  border-radius: 50%;
                  position: absolute;
                  left: 100px;
                  top: 0;
            }
            .mask{
                  width: 100%;
                  height: 100%;
                  position: absolute;
                  left: 0;
                  top: 0;
                  z-index: 999;
            }
            .progress{
                  width: 20px;
                  height: 100px;
                  overflow: hidden;
                  position: absolute;
                  bottom: 0;
                  left: 0;
                  border-radius: 0 2px 2px 0;
            }
            .progress-bar{
                  height: 100px;
                  width: 20px;
                  background:top linear-gradient(yellowgreen,#f10);
                  border-radius: 0 2px 2px 0;
            }
      </style>
	</head>
	<body>
		<div id="container">
            <div class="mask"></div>
            <div id="ball"></div>
            <div class="progress">
                  <div class="progress-bar"></div>
            </div>
      </div>
		
	<script type="text/javascript">
		var timer=null;
		var speed=3;
		var g=0.5;
		var target=400;
		var moving=false;
		var ball=document.getElementById("ball");
		var container=document.getElementById("container");
		var progress=document.querySelector(".progress");
		var speedX=0;
		
		document.addEventListener("click",hanlderClick);
		container.addEventListener("mousemove",handlerMouseMove);
		
		function handlerMouseMove(evt){
			var e=evt||event;
			if(!moving){
				ball.style.left=e.offsetX-20+"px";
				ball.style.top=e.offsetY-20+"px";
			}
			getBallTurn(e.offsetX);
		}
		function getBallTurn(x){
			if (x<=300) {
				var prop=(300-x)/300*100;
				speedX=-5*(prop/100);
			}
			else{
				var prop=(x-300)/300*100;
				speedX=5*(prop/100);
			}
			progress.style.height=prop+"px";
		}
		function hanlderClick(){
			moving=true;
			clearInterval(timer);
			timer=setInterval(ballMove,50);
		}
		function ballMove(){
			speed+=g;
			ball.style.top=ball.offsetTop+speed+"px";
			ball.style.left=ball.offsetLeft+speedX+"px";
			if (Math.abs(target-40-ball.offsetTop)<=speed) {
				ball.style.top=target-40+"px";
				speed=-speed;
				if(speed>-2){
					clearInterval(timer);
					ball.style.top=target-40+"px";
				}
			}
		}
	</script>
	
	</body>
</html>
