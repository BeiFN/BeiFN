<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>烟花</title>
		<style>
		  #container{
		            width: 800px;
		            height: 500px;
		            background: #000;
		            border: 5px solid;
					border-image: linear-gradient(lightcoral,lightseagreen) 30 30;
		            position: absolute;
		            left: 0;
		            top: 0;
		            bottom: 0;
		            right: 0;
		            margin: auto;
		      }      
		      
		      .fireworks{
		            width: 5px;
		            height: 5px;
		            border-radius: 50%;
		            background: #fff;
		            position: absolute;
		      }
		</style>
	</head>
	<body>
		<div id="container">
		</div>
		<script type="text/javascript">
			
			 // 1. 创造随机颜色的div的功能;
			 // 2. 上升功能;
			 // 3. 爆炸功能;
			 
			// 构造函数
			function Fireworks(selector){
				this.main=document.querySelector(selector);
				if (this.main === null) {		
					return false;	// 参数判断;
				}
				this.init();
			}
			
			Fireworks.prototype.init = function(){	
				this.main.addEventListener("click", this.handlerFireClick.bind(this));
			}
			
			// 点击事件函数
			Fireworks.prototype.handlerFireClick=function(evt){
				var e=evt||event;
				var offsetX=e.offsetX;
				var offsetY=e.offsetY;
				var fire=this.fireworksInit(offsetX);	
				this.fireworksMove(fire,offsetY,this.fireworksBoom.bind(this,offsetX,offsetY));
			}
				
			//创建烟花
			Fireworks.prototype.createFirework=function(){
				var fire=document.createElement("div");
				fire.className="fireworks";		 
				fire.style.background=getRandomColor();
				return fire;                   
			}
				
			//烟花初始化
			Fireworks.prototype.fireworksInit=function(offsetX){
				var fire=this.createFirework();
				fire.style.left=offsetX+"px";	
				fire.style.bottom=0;
				this.main.appendChild(fire);
				return fire;
			}
			
			// 烟花移动
			Fireworks.prototype.fireworksMove=function(fire,offsetY,boomCallback){
				move(fire,{
					top:offsetY,
				},function(){		
					fire.remove();
					boomCallback();
				});
			}
			
			// 烟花爆炸
			Fireworks.prototype.fireworksBoom=function(offsetX,offsetY){
				var fireCount=15+Math.round(Math.random()*35);
				var r=100+Math.round(Math.random()*80);
				var angleSpace=Math.round(360/fireCount);		
				var angle=0;
				for (var i=0;i<fireCount;i++) {
					angle+=angleSpace;
					var fireX=Math.round(Math.cos(Math.PI/180*angle)*r+offsetX);		//为避免烟花的抖动,四舍五入取一下整
					var fireY=Math.round(Math.sin(Math.PI/180*angle)*r+offsetY);
					var fire=this.createFirework();
					fire.style.left=fireX+"px";
					fire.style.top=fireY+"px";
					this.main.appendChild(fire);
					move( fire,{
						left:fireX,
						top: fireY,
						opacity:0,
					},function(fire){		
						fire.remove();		
					}.bind(false,fire) );
				}
				  
			}
			 
			// 获取随机数颜色
			function getRandomColor(){
				var r=Math.round(Math.random()*255);
				var g=Math.round(Math.random()*255);
				var b=Math.round(Math.random()*255);
				return "rgb("+r+","+g+","+b+")";
			}
		
			// 运动框架函数
			function move(dom,options,callback){
				clearInterval(dom.timer);
				dom.timer=setInterval(function(){
					for (var attr in options) {
						if (attr==="opacity") {
							var iNow=parseInt(getComputedStyle(dom)[attr]*100);
						}
						else{
							var iNow=parseInt(getComputedStyle(dom)[attr]);
						}
						var speed=(options[attr]-iNow)/10;
						speed=speed>0?Math.ceil(speed):Math.floor(speed);
						if (options[attr]===iNow) {
							delete options[attr];
							if (Object.keys(options).length===0) {
								clearInterval(dom.timer);
								typeof callback==="function"?callback():"";
							}
						}
						else{
							if (attr ==="opacity") {
								dom.style[attr]=(iNow+speed)/100
							}else{
								dom.style[attr]=iNow+speed+"px";
							}
						}
					}
				},80)
			}
			
			// move(container,{
			// 	width:100,
			// 	height:100,
			// 	opacity:30
			// },function(){
			// 	console.log("hello,world!")
			// })
			
			new Fireworks("#container");
// 			var foo= new Fireworks("#container");	
// 			foo.init();
		</script>
	</body>
</html>
