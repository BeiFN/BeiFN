<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>烟花</title>
		<style>
		  #container{
		            width: 800px;
		            height: 500px;
		            background: #000;
		            border: 5px solid;
					border-image: linear-gradient(lightcoral,lightseagreen) 30 30;
		            position: absolute;
		            left: 0;
		            top: 0;
		            bottom: 0;
		            right: 0;
		            margin: auto;
		      }      
		      
		      .fireworks{
		            width: 5px;
		            height: 5px;
		            border-radius: 50%;
		            background: #fff;
		            position: absolute;
		      }
		</style>
	</head>
	<body>
		<div id="container">
		</div>
		
		<script src="commen.js"></script>
		<script type="text/javascript">
			
			 // 1. 创造随机颜色的div的功能;
			 // 2. 上升功能;
			 // 3. 爆炸功能;
			
			let { randomColor , move } = Utils;
			
			class Fireworks{
				
				constructor(){
					this.main=document.querySelector("#container");
					if (this.main === null) {		
						return false;	// 参数判断;
					}
					this.main.addEventListener("click", this.handlerFireClick.bind(this));
				}
				
				// 点击事件函数
				handlerFireClick(evt){
					var e=evt||event;
					var offsetX=e.offsetX;
					var offsetY=e.offsetY;
					var fire=this.fireworksInit(offsetX);	
					this.fireworksMove(fire,offsetY,this.fireworksBoom.bind(this,offsetX,offsetY));
				}
				
				//创建烟花
				createFirework(){
					var fire=document.createElement("div");
					fire.className="fireworks";		 
					fire.style.background=randomColor();
					return fire;                   
				}
				
				//烟花初始化
				fireworksInit(offsetX){
					var fire=this.createFirework();
					fire.style.left=offsetX+"px";	
					fire.style.bottom=0;
					this.main.appendChild(fire);
					return fire;
				}
				
				// 烟花移动
				fireworksMove(fire,offsetY,boomCallback){
					move(fire,{
						top:offsetY,
					},function(){		
						fire.remove();
						boomCallback();
					});
				}
				
				// 烟花爆炸
				fireworksBoom(offsetX,offsetY){
					var fireCount=15+Math.round(Math.random()*35);
					var r=100+Math.round(Math.random()*80);
					var angleSpace=Math.round(360/fireCount);		
					var angle=0;
					for (var i=0;i<fireCount;i++) {
						angle+=angleSpace;
						var fireX=Math.round(Math.cos(Math.PI/180*angle)*r+offsetX);		//为避免烟花的抖动,四舍五入取一下整
						var fireY=Math.round(Math.sin(Math.PI/180*angle)*r+offsetY);
						var fire=this.createFirework();
						fire.style.left=fireX+"px";
						fire.style.top=fireY+"px";
						this.main.appendChild(fire);
						move( fire,{
							left:fireX,
							top: fireY,
							opacity:0,
						},function(fire){		
							fire.remove();		
						}.bind(false,fire) );
					}
					  
				}
				
			}

			new Fireworks();

		</script>
	</body>
</html>
