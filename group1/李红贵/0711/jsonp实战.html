<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>jsonp实战</title>
</head>
<body>
    <script>
        // function jsonpcallback(res){
        //     console.log(res);
        // }
        // //问题1-- 不想在页面加载时发起请求
        // // 让发起请求的script标签受js控制，自己创建script标签
        // document.onclick = function(){
        //     var script = document.createElement("script");
        //     script.src = "http://localhost/0711/jsonptruedata.php?callback=ssss";

        //     script.onload = function(){//script的加载事件
        //         this.remove();
        //     }
        //     document.body.appendChild(script);
        // }

        // 问题2 --- 保证全局函数名受自己控制，避免污染，传递数据到后台


        // 问题3 封装

        // function jsonp(){
        //     window.sss = function(){

        //     }
            
        //     console.log(sss);
        // }
        // jsonp();

        function trueCallback(res){
            console.log(22,res);
            console.log(arguments);
        }
        jsonpl("http://localhost/BaseServer/0711/jsonptruedata.php","trueCallback");

        function jsonpl(url,calback){
        
            var script = document.createElement("script");
            url += /\?/.test(url) ? "&":"?";
            console.log(url);
            url = url + "fooname"+"="+calback;

            console.log(url);
            script.src = url;
            script.onload = function(){
                this.remove();
            }
            document.body.appendChild(script);
        }
        

        
        // function jsonp(url,cb_fild,calback){
        //     console.log(11);
        //     var global_cb = "foo";
        //     // 全局函数
        //     window[global_cb] = function(res){
        //         console.log("php内置函数运行")
              
        //         calback(res);
        //     }
        //     // 发送请求
        //     var script = document.createElement("script");
        //     url += /\?/.test(url) ? "&":"?";
        //     console.log(url);
        //     url = url + cb_fild+"="+global_cb;

        //     console.log(url);
        //     script.src = url;
        //     script.onload = function(){
        //         this.remove();
        //     }
        //     document.body.appendChild(script);
        // }
        // jsonp("http://localhost/BaseServer/0711/jsonptruedata.php","fooname",test);

        // function test(res){
        //     console.log("真实回调函数运行")

        //     console.log(res);
        // }

        // jsonp("http://localhost/BaseServer/0711/05jsonp.php","callback",function(res){
        //           alert(res);
        //     });

    </script>

    <!-- <script src="http://localhost/0711/jsonptruedata.php"></script> -->
</body>
</html>