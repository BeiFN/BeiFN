<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Document</title>
      <style>
            li{
                  list-style-type: none;
            }
            *{
                  margin: 0;
                  padding: 0;
            }

            li{
                  padding: 3px 5px;
                  border-bottom: 2px solid #ddd;
                  text-align: center;
                  width: 80%;
                  margin: 5px auto;
                  background: #fff;
            }
            ul{
                  background: #ddd;
            }
      
      </style>
</head>
<body>

      <ul>
            <li class="lilili"><span>这 <i>是</i> 一个带有事件的li</span></li>
            <li><span>这是一个带有事件的li</span></li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li class="lilili">这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
            <li>这是一个带有事件的li</li>
      </ul>
      <script>
            //  var ul = document.querySelector("ul");
            // ul.addEventListener("click",delegation(handlerClick,".lilili"))
            // function delegation(handlerClick , selector ){

            //       return function(evt){
            //             var eleList = this.querySelectorAll(selector);
            //             // console.log(eleList);
            //             var e = evt || window.event;
            //             var target = e.target || e.srcElement;
            //             var targetFamily = [];

            //             var _temp = target;
            //             var count = 0;
            //             while(true && count++ < 100){
            //                   if(_temp === this){
            //                         break;
            //                   }
            //                   targetFamily.push(_temp)
            //                   _temp = _temp.parentNode
            //             }

            //             // console.log(targetFamily ,target) ;
            //             // 判定target是不是在这个数组之中;
            //             for(var i = 0 , ele ; ele = eleList[i++]; ){
            //                   if( targetFamily.length === 1 ? (target === ele) : (targetFamily.indexOf(ele) !== -1) ){
            //                         handlerClick.call(ele,e);
            //                         break;
            //                   }
            //             }
            //       }
            // }

            // function handlerClick(e){
            //       // console.log("事件执行",this,e);
            //       this.style.background = "yellowgreen";
            // }

            //最终版本
            var ul = document.querySelector("ul");
            ul.addEventListener("click",delegation(handlerClick,".lilili"));

            function delegation(handlerCLick,selector){
                  return function(evt){
                        var e = evt || window.event;
                        var target = e.target || e.srcElement;
                        var eleList = this.querySelectorAll(selector);
                        // console.log(eleList);
                        var _temp = target;
                        var targetFamily = [];

                        while(true){
                              if(_temp === this || _temp === null){
                                    break;
                              }
                              console.log(1)
                              targetFamily.push(_temp);
                              _temp = _temp.parentNode;
                        }
                        console.log(targetFamily);
                        for(var i = 0,ele;ele = eleList[i++];){
                              if(targetFamily.length === 1 ? (ele === targetFamily[0]) : (targetFamily.indexOf(ele) !== -1)){
                                    handlerCLick.call(ele,e);
                                    break;
                              }
                        }
                  }
            }
            function handlerClick(e){
                  this.style.background = "yellowgreen";
            }

            // var ul = document.querySelector("ul");
            // ul.addEventListener("click",delegation(handlerClick,selector));
            // function delegation(handlerCLick,selector){
            //       return function(evt){
            //             var e = evt || window.event;
            //             var target = e.target || e.srcElement;
            //             var eleList = this.querySelectorAll(selector);

            //             for(var i = 0,ele;ele = eleList[i++];){
            //                   if(ele === target){
            //                         handlerCLick.call(ele,e);
            //                         break;
            //                   }
            //             }
            //       }
            // }
           
            // var ul = document.querySelector("ul");
            // ul.addEventListener("click",handlerClick);
            // function handlerCLick(evt){
            //       var e = evt ||window.event;
            //       var target = e.target || e.srcElement;
            //       if(target.nodeName === "LI"){
            //             target.style.background = "yellowgreen";
            //       }
            // }

















            // var ul = document.querySelector("ul");
            // ul.addEventListener("click", function(evt){
            //       // 1. 判定
            //       var e = evt || event;
            //       var target = e.target || e.srcElement;
            //       if(target.nodeName === "LI"){
            //             // 执行事件处理函数;
            //             // 2. 事件处理函数;
            //             handlerClick();
            //       }
            // })

            // function handlerClick(){
            //       console.log("hello i'm handlerClick");
            // }

            // 事件委托在封装啥那 ? ===> 我们在封装判定;
            // 遇到了难题 => 我们在事件委托的时候,遇到两个参数的问题;
            

            // var ul = document.querySelector("ul");
            // ul.addEventListener("click",delegation)
            // function delegation(){

            // }

            // 问题 ： 事件绑定时不太好传递参数;
                  
            // 解决 ,函数内部返回一个函数不就可以了么;

            // delegation => 整合两个函数 ; 1. 匿名函数; 2. 事件处理函数(handlerClick);
            // 事件执行的时候 匿名函数会执行; 
            // 匿名函数的作用 判定是不是应该调用 handlerCLick;
            // var ul = document.querySelector("ul");
            // ul.addEventListener("click",delegation(handlerClick,"LI"))
            // function delegation(handlerClick , selector ){
            //       return function(evt){
            //             // console.log(this); // 永久指向ul
            //             var e = evt || window.event;
            //             var target = e.target || e.srcElement;
            //             // console.log("匿名函数",target);
            //             if(target.nodeName === selector){
            //                   handlerClick.call(target,e);
            //             }
            //       }
            // }

            // function handlerClick(e){
            //       console.log("事件执行",this,e);
            // }
            

            // 优化点;
                  
           
      </script>
</body>
</html>