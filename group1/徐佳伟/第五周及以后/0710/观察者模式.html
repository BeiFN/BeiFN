<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>观察者</title>
</head>
<body>
    
        <script>
            //总结一下
            //观察者只负责接收消息，还有吧自己的个人信息给予发布者让其通知
            //观察者接收到消息在执行自己本体内容

            //发布者需要有一个统计观察者名单
            //发布者需要一个发布功能，便于所有观察者接收消息
            //发布者需要一个订阅功能，当有观察者订阅便登记在名单之上
            //发布者需要移除订阅功能，可以随时取消观察者的订阅

            //观察者
            class Observer{
                constructor(name,age){
                    this.name = name;
                    this.age  = age ;
                }
                //接收消息
                accept(msg){
                    console.log(`我是${this.name},今年${this.age}岁。接收到了消息${msg}`);
                }
            }

            //发布者
            class Publisher{
                constructor(){
                    //订阅者名单
                    this.list = {
                        12 : [],
                        18 : [],
                        other : []
                    }
                   
                }
                //发布消息
                publish(age,msg){
                    let type = age ;
                    if(type <= 12){
                        type = 12;
                    }else if(type > 12 && type <= 18){
                        type = 18;
                    }else{
                        type = "other";
                    }
                    this.list[type].forEach(obs => {
                        obs.accept(msg);
                    });
                    // this.list.forEach(obs => {
                    //     obs.accept(msg);
                    // });
                }
                //订阅消息
                subscribe(age,obs){
                    // this.list.push(obs);
                  
                    if(age<= 12){
                        this.list[12].push(obs);
                    }else if(age >12 && age <= 18){
                        this.list[18].push(obs);
                    }else{
                        this.list["other"].push(obs);
                    }
                }
                //取消订阅
                removeSubscribe(obs){
                    this.list.splice(this.list.indexOf(obs),1);
                }   
            }

            let obs1 = new Observer("翠花",15);
            let obs2 = new Observer("小翠",18);
            let obs3 = new Observer("狗蛋",16);
            let obs4 = new Observer("大柱",19);

            let pub = new Publisher();

            pub.subscribe(obs1.age,obs1);
            pub.subscribe(obs2.age,obs2);
            pub.subscribe(obs3.age,obs3);
            pub.subscribe(obs4.age,obs4);
        </script>
</body>
</html>