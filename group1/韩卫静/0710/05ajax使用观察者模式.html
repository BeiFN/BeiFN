<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		
		<script type="text/javascript">
			// function ajax(url,{
			// 	type        = "GET",
			// 	callback    = res => {},
			// 	data        = {},
			// 	contentType = "application/x-www-form-urlencoded"
			// }={}){
			// 	let xhr = new XMLHttpRequest();
			// 	
			// 	var dataStr = "";
			// 	for(var attr in data){
			// 		dataStr += (dataStr.lenght > 0 ? "&" : "");
			// 		dataStr += `${attr}=${data[attr]}`
			// 	}
			// 	if(dataStr.length != 0){
			// 		url = url + (/\?/.test(url) ? "&" : "?") + dataStr;
			// 	}
			// 	console.log(url);				
			// 	xhr.open(type , url );
			// 	xhr.send(type === "POST"? dataStr : null);
			// 	xhr.onreadystatechange = function(){
			// 		if(xhr.readyState === 4 && xhr.status === 200){
			// 			callback(xhr.responseText);
			// 		}
			// 	}
			// }
			// 
			
			
			// ajax().add(function) ;
			//订阅器
			function ajax(url,{
				type        = "GET",
				data        = {},
				contentType = "application/x-www-form-urlencoded"
			}={}){
				
				var list = [];
				let xhr = new XMLHttpRequest();
				
				var dataStr = "";
				for(var attr in data){
					dataStr += (dataStr.lenght > 0 ? "&" : "");
					dataStr += `${attr}=${data[attr]}`
				}
				if(dataStr.length != 0){
					url = url + (/\?/.test(url) ? "&" : "?") + dataStr;
				}
				console.log(url);				
				xhr.open(type , url );
				type === "POST" ? xhr.setRequestHeader("Content-type" , contentType) : "";
				xhr.send(type === "POST"? dataStr : null);
				xhr.onreadystatechange = function(){
					if(xhr.readyState === 4 && xhr.status === 200){
						list.forEach( callback =>{
							callback(xhr.responseText);
						})
					}
				}
				
				return {
					add : function(){
						list = list.concat( Array.from(arguments));
						return list;
					}
				}
			}
			
			let url = "http://10.9.10.163/hwj/0710/01ajax.txt" ;
			ajax(url,{
				data :{
					name:"hanweijing",
					password:"hhh"
				}
			}).add(function(res){
				console.log("function01 accept : " + res);
			} , function(res){
				console.log("function02 accept : " + res);
			})
		</script>
	</body>
</html>
