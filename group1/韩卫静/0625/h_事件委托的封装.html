<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<style type="text/css">
			ul{
				width: 80%;
				margin: 0 auto;
				background-color: aliceblue;
				list-style: none;
			}
			li{
				text-align: center;
				width: 80%;
				height: 40px;
				line-height: 40px;
				font-size: 18px;
				font-weight: 600;
				border: 1px dashed #AAAAAA;
				margin-bottom: 10px;
				background-color: #fff;
				background: #;
			}
		</style>
	</head>
	<body>
		<ul id="list">
			<li class="dan">这是01个li</li>
			<li>这是02个li</li>
			<li class="dan">这是03个li</li>
			<li>这是04个li</li>
			<li class="dan">这是05个li</li>
			<li>这是06个li</li>
			<li class="dan">这是07个li</li>
			<li>这是08个li</li>
			<li class="dan">这是09个li</li>
			<li>这是10个li</li>
			<li class="dan">这<span>[是包含span和<i>(i标签)</i>的]</span>li</li>
		</ul>
		
		<script type="text/javascript">
			var ulist = document.getElementById("list");
			
			ulist.addEventListener("click", delegation(chooseLiItem,".dan"));
			//用老判断当前事件源是否符合触发条件
			function delegation(fn , seletor){
				return function(evt){
					var e = evt || window.event;
					var target = e.target || e.srcElement;
					
					//只能判断元素类型
					// if(target.nodeName === seletor){
					// 	fn(e);
					// }
					
					//如果点击事件源有多层嵌套时,无法判断是否是符合规定的
					// var eleList = document.querySelectorAll(seletor);
					// for(var i = 0,ele; ele = eleList[i++];){
					// 	if(target === ele){
					// 		fn(e);
					// 	}
					// }
					
					// console.log(this);
					var _tar = target;
					var tarFamily = [];
					
					while(_tar !== this){
						tarFamily.push(_tar);
						_tar = _tar.parentNode;
					}
					var eleList = document.querySelectorAll(seletor);
					for(var i = 0,ele; ele = eleList[i++];){
						if(tarFamily.length ===1 ? (ele === tarFamily[0]) : (tarFamily.indexOf(ele) !== -1)){
							fn.call(ele,e);
							break;
						}
					}
					
				}
			}
			
			function chooseLiItem(e){
				//只能处理当前元素
				// var tar = e.target || e.srcElement;
				// tar.style.background = "aqua";
				
				this.style.background = "aqua";
			}
		</script>
	</body>
</html>
