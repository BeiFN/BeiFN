<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<style type="text/css">
			.ball{
				width: 20px;
				height: 20px;
				border-radius: 50%;
				background: radial-gradient(#ddd,#222);
				position: absolute;
			}
			.text{
				width: 200px;
				height: 100px;
				font-size: 20px;
				line-height: 100px;
				box-shadow: 0 0 5px #0099FF;
				border-radius: 5px;
			}
		</style>
	</head>
	<body>
		<div class="text">
			长点空白发射彩色小球
		</div>
		
		<script type="text/javascript">
			
			function  Particle(ele){
				this.mainPart = ele.nodeType === 9 ? ele : document.querySelector(ele);
				this.timer = null;
				this.cWidth = document.documentElement.clientWidth;
				this.cHeight = document.documentElement.clientHeight;

				this.init();
			}
			Particle.prototype.init = function(){
				this.mainPart.addEventListener("mousedown" , this.startInitBall.bind(this) );
				this.mainPart.addEventListener("mouseup" , this.stopCreateBall.bind(this) );
				this.mainPart.addEventListener("mousemove" , this.positionMove.bind(this))
				console.log(this.mainPart);
			}
			Particle.prototype.startInitBall = function(evt){
				var e = evt || window.event;
				this.offsetX = e.offsetX;
				this.offsetY = e.offsetY;
				clearInterval(this.timer);
				this.timer = setInterval(function(){
					var ball = this.createBall(this.offsetX , this.offsetY);
					setTimeout(function(){
						this.ballMove(ball,this.offsetY);
					}.bind(this),10)
				}.bind(this),100);
				
			}
			Particle.prototype.stopCreateBall = function(){
				clearInterval(this.timer);
				console.log("stop")
			}
			Particle.prototype.createBall = function(offsetX , offsetY){
				var ball = document.createElement("div");
				ball.className = "ball";
				ball.style.left = offsetX + "px";
				ball.style.top = offsetY + "px";
				ball.style.transition = "all 1s";
				ball.style.background = "radial-gradient(" + getRandomColor() + "," + getRandomColor() + ")" ;
				document.body.appendChild(ball);
				return ball;
			}
			Particle.prototype.ballMove = function(ele , offsetY){
				var randomT = offsetY + Math.round( Math.random()* (this.cHeight - offsetY) );
				var randomL = Math.round(Math.random() * this.cWidth);
				ele.style.left = randomL + "px";
				ele.style.top = randomT + "px";
			}
			Particle.prototype.positionMove = function(evt){
				var e = evt || window.event;
				// this.offsetX = e.offsetX;
				// this.offsetY = e.offsetY;
				//避免鼠标点到小球上,而产生错误的offsetX和offsetY
				this.offsetX = e.clientX ; 
                 this.offsetY = e.clientY;
			}
			
			new Particle(document);
			
			//---------------------------------------------------------------
			function getRandomColor(){
				var r = Math.round(Math.random() * 255);
				var g = Math.round(Math.random() * 255);
				var b = Math.round(Math.random() * 255);
				return "rgb(" + r + "," + g + "," + b + ")"
			}
		</script>
	</body>
</html>
