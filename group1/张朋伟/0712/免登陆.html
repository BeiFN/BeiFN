<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>我的login</title>
</head>

<body>
      <form id="form">
            <p>用户名 : <input type="text" name="username" value="123"></p>
            <p>密 码 : <input type="text" name="password" value="123"></p>
            <button id="btn">提交</button>
      </form>

      <script src="libs/utils.js"></script>
      <script>
           
            let {
                 
                  ajax,
                  $
            } = Utils;
            // let [btn, form] = [$("#btn"), $("#form")];
            // console.log(ajax);
            // console.log($);

            //绑定事件
            form.addEventListener("submit", evt => {
                  let e = e || window.event;
                  e.preventDefault();
            })
            btn.addEventListener("click", () => {
                  let usrValue = $("input[name=username]");
                  let pwdValue = $("input[name=password]");

                  btn.disabled = "disabled";
                  btn.innerHTML = "loading...";


                  // 获取后台url
                  let url = "http://localhost/0712/login.php";
                  //组合数据
                  let data = {
                        username: usrValue,
                        password: pwdValue,
                  }

                  ajax(
                        url, {
                              data,
                              type: "POST",
                              dataType: "json"
                        }

                  ).then(
                        (res) => {

                              switch (res.stateCode) {
                                    case 0:
                                          alert("登陆参数不全");
                                          break;
                                    case 2:
                                          alert("数据库连接失败");
                                          break;
                                    case 3:
                                          alert("用户名不存在");
                                          break;
                                    case 4:
                                          alert("密码错误");
                                          break;
                                    case 1:
                                          alert("登陆成功");
                                          location.reload();
                                          remove
                                          break;
                              }
                              btn.removeAttribute("disabled");//用完直接删除？？？？？？？？？？？？
                              btn.innerHTML = "登陆";

                        })
            })

            //若存在cookie,直接登录，否则进入登录模式，保存cookie
            function yz(){
                  let url = "http://localhost/0712/login.php";
                  ajax(url).then(
                        (res)=>{
                              res=JSON.parse(res);
                              // console.log(res)

                              if(res.state){//按照普通方式登录
                                    return false;
                              }

                              form.innerHTML = "用户名："+res.username+"密码是"+res.password;

                        }
                  )

            }
            yz();
            //事件提交
      </script>
</body>

</html>