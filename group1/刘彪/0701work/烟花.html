<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
            #container{
                  width: 600px;
                  height: 400px;
                  background: #000;
                  border: 2px solid #f10;
                  position: absolute;
                  left: 0;
                  top: 0;
                  bottom: 0;
                  right: 0;
                  margin: auto;
            }      
            
            .firework{
                  width: 7px;
                  height: 7px;
                  border-radius: 50%;
                  background: #fff;
                  position: absolute;
            }
      </style>
</head>
<body>
      <div id="container">
      </div>

      <script>
          //1.创造随机颜色的div的功能;
          //2.上升功能;
          //3.爆炸功能;

          //创建构建函数
          function Firework(selector){
            this.main = document.querySelector(selector);
            //参数判断
            if(this.main === null){return false};
            //调用初始化函数;
            this.init();
          }
          //解决耦合关系;init = >初始化功能;
          Firework.prototype.init = function(){
            this.main.addEventListener("click",this.handlerFireClick.bind(this));
          }

          Firework.prototype.handlerFireClick = function (evt){
              var e = evt || event;
              var offsetX = e.offsetX;
              var offsetY = e.offsetY;
              var fire = this.fireworkInit(offsetX);
              this.fireworkMove(fire,offsetY,this.fireworkBoom.bind(this,offsetX,offsetY));

          }

          Firework.prototype.fireworkInit = function(offsetX){
              var fire = this.createFirework();
              fire.style.left = offsetX +"px";
              fire.style.bottom = 0;
              this.main.appendChild(fire);
              return fire;
          }

          Firework.prototype.createFirework = function(){
              var fire = document.createElement("div");

              fire.className = "firework";
              fire.style.background = getRandomColor();

              return fire;
          }
          function getRandomColor(){
                  var r = Math.round(Math.random() * 255);
                  var g = Math.round(Math.random() * 255);
                  var b = Math.round(Math.random() * 255);
                  return "rgb(" + r + "," + g + "," + b + ")";
            }

            Firework.prototype.fireworkMove  = function(fire,offsetY,boomCallback){
                move(fire,{
                    top:offsetY,
                },function(){
                    fire.remove();
                    boomCallback();
                })
            }
            Firework.prototype.fireworkBoom = function(offsetX,offsetY){
                var randomFireCount = 15 + Math.round(Math.random()*10);
                var blank = Math.round(360/randomFireCount);
                var r  = 100 + Math.round(Math.random()*100);
                var angle = 0;
                for(var i = 0;i < randomFireCount; i++){
                    angle += blank;

                    var fire_targetX = Math.round(Math.cos(Math.PI/180 * angle) * r + offsetX );
                    var fire_targetY = Math.round(Math.sin(Math.PI/180 * angle) * r + offsetY);


                    var fire_boom =this.createFirework();
                    fire_boom.style.left = offsetX + "px";
                    fire_boom.style.top = offsetY +"px";
                    this.main.appendChild(fire_boom);

                    move(fire_boom,{
                        left : fire_targetX,
                        top  : fire_targetY,
                        opacity: 0 ,
                    },function(fire_boom){
                        fire_boom.remove();
                    }.bind(false,fire_boom))
                }


            }













          new Firework("#container");


        function move(dom, options, callback) {
            console.log(dom,options,callback)
            //清空计时器
            clearInterval(dom.timer);
            //计时器
             dom.timer = setInterval(function () {
                // console.log(1);
                //遍历options,判断属性
                for (var attr in options) {
                    if (attr === "opacity") {
                        var iNow = parseInt(getComputedStyle(dom)[attr] * 100)
                    }
                    else {
                        var iNow = parseInt(getComputedStyle(dom)[attr]);
                    }
               
                console.log(iNow);
                //定义速度
                var speed = (options[attr] - iNow) / 10;
                speed = speed > 0 ? Math.ceil(speed) : Math.floor(speed);

                // console.log(speed);
                //结束条件>所有属性运动结束后再去关闭定时器;
                if (options[attr] === iNow) {
                    delete options[attr];

                    if (Object.keys(options).length === 0) {
                        clearInterval(dom.timer);
                        typeof callback === "function" ? callback (): "";
                    }
                    // 否则设置属性的值
                }
                 else {
                        if (attr === "opacity") {
                            dom.style[attr] = (iNow + speed) / 100;
                        } else {
                            dom.style[attr] = iNow + speed + "px";
                        }
                    }
            }

            }, 50)

        }

          
      </script>
</body>
</html>