<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Document</title>
      <link rel="stylesheet" href="./音量调节拖拽.css">
</head>

<body>
      <div id="bar" draggable="false">
            <div class="horn" draggable="false"></div>
            <div class="progress" title="10" draggable="false">
                  <div class="progress-bar" draggable="false"></div>
                  <div class="progress-point" draggable="false"></div>
            </div>
      </div>
      <script>
            function $$(ele) {
                  
                  
                  var res = document.querySelectorAll(ele);
                  return res.length === 1 ? res[0] : res;
            }
            var proPoint = $$(".progress-point");
            var bar = $$(".progress-bar");
            var progressBox = $$(".progress");
            var horn = $$(".horn");
            function ProgressDrag() {
                  this.init();
            }
            Object.assign(ProgressDrag.prototype, {
                  init: function () {
                        this.data = {
                              proL: progressBox.offsetLeft,
                              proWid: progressBox.offsetWidth,
                              volume: {
                                    "low": "https://upload-images.jianshu.io/upload_images/16960494-86ea623e30ad4c2d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",
                                    "hight": "https://upload-images.jianshu.io/upload_images/16960494-0192f12b7372e21e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",
                                    "mute": "https://upload-images.jianshu.io/upload_images/16960494-e859bac6f34f9188.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",
                                    "middle": "https://upload-images.jianshu.io/upload_images/16960494-ecacc6b836a0661e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",
                              },
                        };
                        this.bindEvent();
                  },
                  bindEvent: function () {
                        proPoint.addEventListener("mousedown", this.handlerVolumeChangeStart.bind(this));
                        document.addEventListener("mouseup", this.handlerVolumeChangeEnd.bind(this));
                  },
                  handlerVolumeChangeStart: function (evt) {
                        var e = evt || window.event;
                        this.data.X = e.offsetX;
                        document.addEventListener("mousemove", this.bind1=this.handlerVolumeChangeMove.bind(this))
                  },
                  handlerVolumeChangeMove: function (evt) {
                        var e = evt || window.event;
                        var left = e.clientX - this.data.X - this.data.proL;
                        left = left < -15 ? -15 : left;
                        left = left >= this.data.proWid - 15 ? this.data.proWid - 15 : left;
                        proPoint.style.left = left + "px";
                        var prop = this.changeProgressBarWidth(left);
                        progressBox.title = prop + "%";
                        this.changeVolumeIcon(prop);
                  },
                  changeProgressBarWidth: function (_left) {
                        bar.style.width = _left + 15 + "px";
                        return parseInt((_left + 15) / this.data.proWid * 100)
                  },
                  // 根据比例切换小喇叭图片;
                  changeVolumeIcon: function (prop) {
                        if (prop === 0) {
                              // 静音图标
                              horn.style.backgroundImage = "url(" + this.data.volume.mute + ")"
                        } else if (prop > 0 && prop < 33) {
                              horn.style.backgroundImage = "url(" + this.data.volume.low + ")"
                        } else if (prop >= 33 && prop < 66) {
                              horn.style.backgroundImage = "url(" + this.data.volume.middle + ")"
                        } else {
                              horn.style.backgroundImage = "url(" + this.data.volume.hight + ")"
                        }
                  },
                  handlerVolumeChangeEnd: function () {
                        document.removeEventListener("mousemove", this.bind1)
                  }
            })
            var progressDrag=new ProgressDrag();
      </script>
</body>

</html>