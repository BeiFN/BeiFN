<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>大师解梦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body,
        html {
            width: 100%;
            height: 100%;
            background: #333;
            color: antiquewhite;
        }

        .box {
            width: 600px;
            height: 500px;
            margin: auto;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        button {
            width: 170px;
            height: 30px;
            background: #000;
            color: #fff;
            outline: none;
            border: none;
            cursor: pointer;
        }

        .box>p {
            width: 100%;
            height: 40px;
            text-align: center;
        }

        #tipBox {
            width: 100%;
            height: 380px;
            position: relative;
            overflow: auto;
        }

        .dream {
            cursor: pointer;
            display: inline-block;
            border: 1px solid #afa;
            border-radius: 3px;
            padding: 5px;
            margin: 10px;
            background: #fff;
            color: #faa;
            transition: all .5s;
        }

        .dream:hover {
            background: #000;
            padding: 10px;
            margin: 5px;
        }

        .box .drmTip {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: left;
            text-indent: 2em;
            z-index: 888;
            left: 0;
            top: 0;
            background: #fff;
            color: #aaf;
            cursor: default;
            overflow: hidden;
        }

        .more {
            text-align: center;
            text-indent: 0;
            line-height: 50px;
            display: block;
            width: 100px;
            height: 50px;
            position: absolute;
            bottom: 50px;
            right: 60px;
            z-index: 999;
            background: #000;
            color: #fff;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="box" id="box">
        <p>亲！您梦到什么了呢</p>
        <p><input type="text" name="" id="ipt" placeholder="请输入关键字"></p>
        <p><button id="btn">解梦</button></p>
        <div id="tipBox"></div>
    </div>

    <script src="../../ku/hanshuku.js"></script>
    <script>
        let url = "http://10.9.10.134/1000/daily/0711/dream.php",
            target = {},
            loading = false;
        on(btn, "click", loadDream);
        on(ipt, "keydown", evt => {
            let e = evt || event,
                code = e.keyCode || e.which;
            if (code === 13) loadDream();
        })
        on(tipBox, "click", function () {
            let p = document.createElement("p"),
                more = document.createElement("span");
            p.className = "drmTip";
            more.className = "more";
            p.innerHTML = this.getAttribute("data-des");
            more.innerHTML = "查看更多";
            box.appendChild(p);
            p.appendChild(more);
            target.id = this.getAttribute("data-id");
            target.box = p;
        }, ".dream");
        // 点击移除按钮，加载详细信息
        on(box, "click", function () {
            this.remove();
            loadDrmTip();
        }, ".more");
        // 点击移除信息框
        on(box, "click", function () {
            this.remove();
        }, ".drmTip");
        // 加载梦境title
        function loadDream() {
            if (loading) return false;
            loading = true;
            ajax(url, {
                q: ipt.value,
                url: "http://v.juhe.cn/dream/query"
            }).then(res => {
                res = JSON.parse(res);
                let html = "";
                if (res.error_code=="10012") {
                    html = "不好意思，大仙法力耗尽，请明日再来"
                } else {
                    if (!res.result) {
                        html = "emmmm</br>......</br>要不...换个梦试试???</br>少写点啥"
                    } else {
                        res.result.forEach(item => {
                            html += `<span class="dream" data-id="${item.id}" data-des="${item.des}">${item.title}</span>`
                        });
                    }
                }
                tipBox.innerHTML = html;
                loading = false;
            })
        }
        // 加载详细信息
        function loadDrmTip() {
            ajax(url, {
                id: target.id,
                url: "http://v.juhe.cn/dream/queryid",
            }).then(res => {
                res = JSON.parse(res);
                let html = "";
                if (res.error_code=="10012") {
                    html = "不好意思，大仙法力耗尽，请明日再来"
                } else {
                    res.result.list.forEach(item => {
                        html += `<p>${item}</p>`;
                    });
                }
                target.box.innerHTML = html;
            })
        }
    </script>
</body>

</html>