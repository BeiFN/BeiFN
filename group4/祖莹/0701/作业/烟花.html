<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
            #container{
                  width: 800px;
                  height: 600px;
                  margin: 40px auto;
                  background: #000;
                  border: 1px solid #ddd;
                  position: relative;
                  overflow: hidden;
            }
            .fire-work{
                  width: 10px;
                  height: 10px;
                  position: absolute;
                  top: 0;
                  left: 0;
                  border-radius: 50%;
            }
      </style>
</head>
<body>
        <div id="container"></div>
            <script src="libs/common.js"></script>
            <script>
                  // OOD 
                  function FireWork(){
                  }
                  FireWork.prototype.init = function(main){
                        // mainElem => 烟花容器 => div;
                        this.mainEle = main;
                        this.bindEvent();
                  }
                  FireWork.prototype.bindEvent = function(){
                        this.mainEle.addEventListener("click",this.createFire.bind(this));
                        this.mainEle.addEventListener("click",this.fireRise.bind(this));
                  }
                  // 创建烟花;
                  FireWork.prototype.createFire = function(evt){
                        let e = evt || window.event;
                        // 创建一个div并给他加上类名，添加随机颜色;
                        let div = document.createElement("div");
                        div.className = "fire-work";
                        div.style.background = this.randomColor();
                        // 设置初始位置;
                        div.style.left = (e.offsetx ? e.offsetx : e.offsetX)  + "px";
                        this.mainEle.appendChild(div);
                        let initTop = parseInt(getComputedStyle(this.mainEle)["height"]) - parseInt(getComputedStyle(div)["height"]);
                        div.style.top = initTop + "px";
                        // 把div地址放进 fireWork实例对象之中方便 fireRise 访问;
                        this.fire = div;
                        // 为了方便烟花爆炸功能使用 , 所以要把div返回出去：
                        return div;
                  }
                  // 随机颜色;
                  FireWork.prototype.randomColor = function(){
                        let [r,g,b,a] = [
                                          Math.round(Math.random() * 255),
                                          Math.round(Math.random() * 255),
                                          Math.round(Math.random() * 255),
                                          (5 + Math.round(Math.random() * 5)) / 10
                                     ]
                        return `rgba(${r},${g},${b},${a})`;
                  }
                  // 烟花上升;
                  FireWork.prototype.fireRise = function(evt){
                        let [e , fire ]= [evt || window.event , this.fire];
                        let { offsetX , offsetY  }  = e;
                        move(this.fire,{
                              top : offsetY
                        },this.fireBlast.bind(this,fire,offsetX,offsetY));
                  }     
                  // 烟花爆炸;
                  FireWork.prototype.fireBlast = function(fire,offsetX,offsetY){
                        fire.remove();
                        // let ele = null;
                        let [ r , angle , count , duration ] = [ 80 + Math.round (Math.random() *80 ) , 0 , 21 , (5 + Math.round(Math.random() * 20)) / 10]
                        for(let i = 0 ; i++ < count ;){
                              // 连缀;
                              // (ele =  this.createFire({ offsetX })).style.top  = offsetY + "px"; 
                              let ele = this.createFire({offsetX});
                              ele.style.top = offsetY + "px";
                              setTimeout(()=>{
                                    ele.style.transition = `all ${duration}s`;
                                    angle = Math.round( 360 / count * i);
                                    // console.log(angle);
                                    let ele_x = r * Math.cos( Math.PI / 180 * angle);
                                    let ele_y = r * Math.sin( Math.PI / 180 * angle);
                                    ele.style.left = ele_x + offsetX + "px";
                                    ele.style.top = ele_y  + offsetY+ "px";
                              },50)
                              setTimeout(()=>{
                                    ele.remove();
                              },duration * 1000)
                        }
                  }
                  FireWork.prototype.autoPlay = function(delay){
                        this.delay = delay ? delay : 2000;
                        let position = {
                              offsetX : Math.round(Math.random() * 800),
                              offsetY : Math.round(Math.random() * 600)
                        }
                        this.createFire(position);
                        this.fireRise(position);
                        // 一种写法;
                        setTimeout(this.autoPlay.bind(this),this.delay)
                  }
                  var main = document.getElementById("container");
                  var fireWork = new FireWork();
                  fireWork.init(main);
                  fireWork.autoPlay(100);
            </script>
</body>
</html>