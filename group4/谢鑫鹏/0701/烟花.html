<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #container{
            width: 600px;
            height: 400px;
            background: #000;
            border: 2px solid #f10;
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            right: 0;
            margin: auto;
        }
        .firework{
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: #fff;
            position: absolute;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <script>
    function Firework(selector){
        this.main = document.querySelector(selector);
        if(this.main === null){
            return false;
        }
        this.init();
    }
    // 初始化
    Firework.prototype.init = function(){
        this.main.addEventListener("click", this.handleFirework.bind(this));
    }
    // 处理烟花
    Firework.prototype.handleFirework = function(evt){
        var e = evt || window.event;
        var offsetX = e.offsetX;
        var offsetY = e.offsetY;
        var firework = this.initFirework(offsetX);
        this.fireworkMove(firework,offsetY,this.fireworkBlast.bind(this,offsetX,offsetY));
    }
    // 烟花爆炸
    Firework.prototype.fireworkBlast = function(offsetX,offsetY){
        var randomFireCount = 20 + Math.round(Math.random() * 10);
        var distance = parseInt(360 / randomFireCount);
        var r = 50 + Math.round(Math.random() * 50);
        var angle = 0;
        for(var i = 0; i < randomFireCount; i++){
            angle += distance;
            var fireTargetX = Math.round(Math.cos(Math.PI / 180 * angle) * r + offsetX);
            var fireTargetY = Math.round(Math.sin(Math.PI / 180 * angle) * r + offsetY);
            var subFirework = this.createFirework();
            subFirework.style.left = offsetX + "px";
            subFirework.style.top = offsetY + "px";
            this.main.appendChild(subFirework);
            move(subFirework, {
                left : fireTargetX,
                top : fireTargetY,
                opacity : 0
            },function(subFirework){
                subFirework.remove();
            }.bind(null,subFirework))
        }
    }
    // 烟花运动
    Firework.prototype.fireworkMove = function(firework,offsetY,blastCallback){
        move(firework, {
            top : offsetY
        },function(){
            firework.remove();
            blastCallback();
        })
    }
    // 初始化烟花
    Firework.prototype.initFirework = function(offsetX){
        var firework = this.createFirework();
        firework.style.left = offsetX + "px";
        firework.style.bottom = 0;
        this.main.appendChild(firework);
        return firework;
    }
    // 生成烟花
    Firework.prototype.createFirework = function(){
        var firework = document.createElement("div");
        firework.className = "firework";
        firework.style.background = randomColor();
        return firework;
    }
    // 随机颜色
    function randomColor(){
        var r = Math.round(Math.random() * 255);
        var g = Math.round(Math.random() * 255);
        var b = Math.round(Math.random() * 255);
        return "rgb(" + r + "," + g + "," + b + ")";
    }
    // 运动框架
    function move(dom, options, callback){
        clearInterval(dom.timer);
        dom.timer = setInterval(function(){
            for(var attr in options){
                if(attr === "opacity"){
                    var iNow = parseInt(getComputedStyle(dom)[attr] * 100);
                }else{
                    var iNow = parseInt(getComputedStyle(dom)[attr]);
                }
                var speed = (options[attr] - iNow) / 10;
                speed = speed > 0 ? Math.ceil(speed) : Math.floor(speed);
                if(options[attr] === iNow){
                    delete options[attr];
                    if(Object.keys(options).length === 0){
                        clearInterval(dom.timer);
                        typeof callback === "function" ? callback() : "";
                    }
                }else{
                    dom.style[attr] = attr === "opacity" ? (iNow + speed) / 100 : iNow + speed + "px";
                }
            }
        },50)
    }

    new Firework("#container");
    </script>
</body>
</html>